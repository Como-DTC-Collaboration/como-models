---
title: "The SEIRSD model"
author: "Solveig A. van der Vegt and Ben Lambert"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{The SEIRSD model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(comomodels)
library(tidyverse)
library(glue)
```

## Introduction
This document explains the basics of the SEIRSD model. The model describes
how populations of susceptible, exposed, infectious, recovered and dead
individuals evolve over time. A simple
ordinary differential equation (ODE) is defined for each of the populations.

## The SEIRSD Model
The SEIR model consists of five ODEs: one for each of the populations. Susceptible
individuals ($S$) have not been exposed to the virus; exposed individuals ($E$) have been
exposed to the virus and have been infected but are not yet infectious to others: they are 
in the incubation period; infectious individuals ($I$) spread the virus to 
others and may die (going into the $D$ population); recovered individuals ($R$) are no longer infectious, and, in this model, have immunity that wanes over time with them becoming susceptible once more. Births are not considered in this model.
The ODEs describing how these populations evolve over time are
$$\frac{\text{d}S}{\text{d}t} = \alpha R -\beta S I,$$
$$\frac{\text{d}E}{\text{d}t} = \beta S I -\kappa E,$$
$$\frac{\text{d}I}{\text{d}t} = \kappa E - (\gamma + \mu) I,$$
$$\frac{\text{d}R}{\text{d}t} = \gamma I - \alpha R,$$
where $\alpha$, $\beta$, $\kappa$, $\gamma$ and $\mu$ are positive parameters.
The rate at which susceptible individuals are infected depends on the fraction
of the population that is susceptible, the fraction of the population that is
infectious, and the probability of an infectious individual infecting a 
susceptible individual, $\beta$. This is represented in the
second term on the right-hand side of $\text{d}S/ \text{d}t$ and the first term
on the right-hand side of $\text{d}I/ \text{d}t$.
Exposed individuals become infectious at rate $\kappa$. $1/ \kappa$ is
the incubation time of the virus, i.e. how many days after exposure the individual
becomes infectious to others. Infectious individuals can either recover or die
because of the disease. Infectious individuals recover in $1/ \gamma$
days, thus individuals recover at rate $\gamma$. Similarly, infectious
individuals die due to the infection after $1/ \mu$ days, making the death rate $\mu$.
Lastly, immunity in this model does not last forever, and after $1/\alpha$ days,
recovered individuals become susceptible again. This is reflected in the last
term on the right-hand side of $\text{d}R/ \text{d}t$ and the first term on
the right-hand side of $\text{d}S/ \text{d}t$.

In addition to these four main ODEs, the model also keeps track of the number 
of cases ($C$) and the number of disease-related deaths ($D$) over time
$$\frac{\text{d}C}{\text{d}t} = \beta S I,$$
$$\frac{\text{d}D}{\text{d}t} = \mu I.$$

The system is closed by specifying the initial conditions
$$S(0) = S_0,\ E(0) = E_0,\ I(0) = I_0,\ R(0) = R_0,\ C(0) = C_0,\ D(0) = D_0,$$
where $C_0 = E_0 + I_0 + R_0$ to ensure the cases that occur before $t=0$ are
also counted.
In the implementation in this package, the variables are normalized so 
$S(t) + E(t) + I(t) + R(t) + D(t) \equiv 1$ for any given $t$.

Because we build on this basic model to develop more complex epidemiological models,
we solve the ODEs over time instead of just solving for the steady states. The
next section shows an example of how to use the `SEIRSD` class.

## The `SEIRSD` class
In this section we will walk through an example of how to simulate from the SEIRSD model.

To create a new `SEIRSD` object, run:
```{r}
model <- SEIRSD()
```

Next, we set the parameter values for $\beta$, $\kappa$, $\gamma$, $\mu$ and $\alpha$:
```{r}
transmission_parameters(model) <- list(1, 0.9, 0.5, 0.1, 4.0)
```

The four values in the list on the right-hand side are assigned to $\beta$,
$\kappa$, $\gamma$, $\mu$ and $\alpha$, respectively.

To check that the parameters have been set correctly, we call
```{r}
transmission_parameters(model)
```

We now need to set the initial conditions for the model. We only set the initial
conditions $S(0)$, $E(0)$, $I(0)$ and $R(0)$.
```{r}
initial_conditions(model) <- list(0.99, 0, 0.01, 0)
```

The values in the list on the right-hand side are assigned to $S(0)$, $E(0)$, $I(0)$ and $R(0)$,
respectively. The initial conditions must sum to one. If they do not, an error is thrown.

Now we can simulate the system.
```{r}
results <- run(model, time=seq(0, 200, by = 0.1))
```

Let's visualise the results.
```{r}
results %>% 
  filter(!compartment %in% "Incidences") %>% 
  ggplot(aes(x=time, y=value, colour=compartment)) +
  geom_line()
```

