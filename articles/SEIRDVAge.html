<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="comomodels">
<title>Vaccinations: age-structured model • comomodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Vaccinations: age-structured model">
<meta property="og:description" content="comomodels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">comomodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/SEIRD_age_structured.html">Age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRDNPIAge.html">NPIs: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD.html">SEIRD model</a>
    <a class="dropdown-item" href="../articles/SEIRDV.html">Vaccinations model</a>
    <a class="dropdown-item" href="../articles/SEIRDVAge.html">Vaccinations: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD_rural_urban.html">Urban and rural metapopulations model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="SEIRDVAge_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Vaccinations: age-structured model</h1>
                        <h4 data-toc-skip class="author">Ioana Bouros</h4>
            
      
      
      <div class="d-none name"><code>SEIRDVAge.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">comomodels</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2</span> 3.3.5     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.6     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.0.7</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document explains the basics of the SEIRV model with age structure. The model describes how populations of susceptible, exposed, infectious, recovered and vaccinated individuals evolve over time. Waning immunity is also considered in this model, so there is a constant supply of susceptibles in the population which makes the model more realistic. Contact data and age structure are also considered in the model.</p>
<p>However, in reality, a susceptible individual from a given age class can become infected from any age class: to capture this aspect of the model, infected individuals of any age are supposed to inter-mix, with the mixing rate dictated by a so-called “contact matrix”, <span class="math inline">\(C\)</span>.</p>
<p>The elements of contact matrices, <span class="math inline">\(C_{i,j}\)</span> indicate the expected number of contacts an individual of age class <span class="math inline">\(i\)</span> experiences with age class <span class="math inline">\(j\)</span> per day. In this package, we include country-level estimates of contact matrices (Prem et al., 2017; for full details see data documentation). There are actually four types of contact matrix corresponding to daily numbers of contacts at home, work, school and all other settings. Here, we visualise these for India.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/contact_home.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/contact_work.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/contact_school.rda"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/contact_other.rda"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># reformat matrices for plotting</span>
<span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">age_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">age_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ages</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"-"</span>, <span class="va">ages</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">format_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">contact_matrix</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span><span class="op">$</span><span class="va">age_infectee</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infector</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infectee<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">c_home</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_home</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"home"</span><span class="op">)</span>
<span class="va">c_work</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_work</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"work"</span><span class="op">)</span>
<span class="va">c_school</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_school</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"school"</span><span class="op">)</span>
<span class="va">c_other</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_other</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"other"</span><span class="op">)</span>
<span class="va">c_all</span> <span class="op">&lt;-</span> <span class="va">c_home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_work</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_school</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_other</span><span class="op">)</span>
<span class="co"># plot all</span>
<span class="va">c_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_infector</span>, y<span class="op">=</span><span class="va">age_infectee</span>, fill<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"age group of infector"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"age group of infectee"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">type</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-3-1.png" width="960"></p>
<p>We can see that the majority of contacts fall between younger individuals, occurring at home or “other” locations. At home, however, there is more substantial intergenerational mixing than in other settings.</p>
<p>The model we introduce here does not compartmentalise individuals according to location, so we make an overall contact matrix by summing these together.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">c_combined</span> <span class="op">&lt;-</span> <span class="va">c_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_infector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'age_infectee'. You can override using the `.groups` argument.</span>
<span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_infector</span>, y<span class="op">=</span><span class="va">age_infectee</span>, fill<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"age group of infector"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"age group of infectee"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>We now use this contact matrix to allow infections to pass between age groups. To do so, we amend the governing equations for the susceptibles and exposed individuals within age class <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\begin{align}
\frac{\text{d}S_i}{\text{d}t} &amp;= -\beta S_i \Sigma_{j}C_{ij} I_j\\
\frac{\text{d}E_i}{\text{d}t} &amp;= \beta S_i \Sigma_{j}C_{ij} I_j -\kappa E_i\\
\end{align}\]</span></p>
<p>Specifically, the term <span class="math inline">\(S_i \Sigma_{j}C_{ij} I_j\)</span> effectively indicates the expected number of contacts between susceptible individuals of age class <span class="math inline">\(i\)</span> with infected individuals across all classes.</p>
</div>
<div class="section level2">
<h2 id="the-seirdvage-model">The SEIRDVAge Model<a class="anchor" aria-label="anchor" href="#the-seirdvage-model"></a>
</h2>
<p>The SEIRDVAge model consists of five ODEs describing five populations of susceptible, recovered, infectious, recovered and vaccinated individuals. Susceptible individuals (<span class="math inline">\(S\)</span>) have not been exposed to the virus. Exposed individuals (<span class="math inline">\(E\)</span>) have been exposed to the virus and have been infected but are not yet infectious to others; they are in the incubation period. Infectious individuals (<span class="math inline">\(I\)</span>) can spread the virus to others. Recovered individuals (<span class="math inline">\(R\)</span>) are no longer infectious, but they can return to the susceptible population when they lose their immunity. Vaccinated individuals (<span class="math inline">\(V\)</span>) cannot become infected and are not ill at the time, but as it was the case with the recovered population, their immunity is temporary and they can become susceptible again with a certain rate. We can vaccinate not only the susceptibles, but also <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span> and <span class="math inline">\(R\)</span>s. However, they have already been exposed to the illness so they do not change compartment assignment. Births and deaths unrelated to the infection are not considered in this model. The ODEs describing how the five populations evolve over time are <span class="math display">\[\frac{\text{d}S_i}{\text{d}t} = -\beta S_i \Sigma_{j}C_{ij} I_j - \nu \text{Inter}_i(t) S_i + \delta_{V} V_i + \delta_{R} R_i + \delta_{VR} VR_i,\]</span> <span class="math display">\[\frac{\text{d}E_i}{\text{d}t} = \beta S_i \Sigma_{j}C_{ij} I_j -\kappa E_i,\]</span> <span class="math display">\[\frac{\text{d}I_i}{\text{d}t} = \kappa E_i - (\gamma + \mu) I_i,\]</span> <span class="math display">\[\frac{\text{d}R_i}{\text{d}t} = \gamma I_i - \delta_R R_i - \nu \text{Inter}_i(t) R_i,\]</span> <span class="math display">\[\frac{\text{d}V_i}{\text{d}t} = \nu \text{Inter}_i(t) S_i - \delta_V V_i\]</span> <span class="math display">\[\frac{\text{d}VR_i}{\text{d}t} = \nu \text{Inter}_i(t) R_i - \delta_{VR} VR_i\]</span></p>
<p>where <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\nu\)</span>, <span class="math inline">\(\delta_V\)</span>, <span class="math inline">\(\delta_R\)</span> and <span class="math inline">\(\delta_{VR}\)</span> are positive parameters. The rate at which susceptible individuals are infected depends on the fraction of the population that is susceptible, the fraction of the population that is infectious, and the odds of an infectious individual infecting a susceptible individual, <span class="math inline">\(\beta\)</span>. This is represented in the first terms on the right-hand side of <span class="math inline">\(\text{d}S/ \text{d}t\)</span> and <span class="math inline">\(\text{d}E/ \text{d}t\)</span>. Exposed individuals become infectious at rate <span class="math inline">\(\kappa\)</span>. <span class="math inline">\(1/ \kappa\)</span> is the incubation time of the virus, i.e. how many days after exposure the individual becomes infectious to others. Infectious individuals can either recover or die because of the disease. Infectious individuals recover in <span class="math inline">\(1/ \gamma\)</span> days, thus individuals recover at rate <span class="math inline">\(\gamma\)</span>. Similarly, infectious individuals die due to the infection after <span class="math inline">\(1/ \mu\)</span> days, making the death rate <span class="math inline">\(\mu\)</span>. Susceptible individuals are vaccinated at a maximum rate <span class="math inline">\(\nu\)</span>. Among those who are immune (recovered and vaccinated), people lose their immunity against the virus at different rates depending on what type of immunity they acquired: <span class="math inline">\(\delta_V\)</span> for those vaccinated, <span class="math inline">\(\delta_R\)</span> for those previously infected and <span class="math inline">\(\delta_{VR}\)</span> for those previously infected that received the vaccine after they recovered. <span class="math inline">\(\text{Inter}(t)\)</span> is the value at time t of the intervention protocol defined by the intervention parameters.</p>
<p>In addition to these five main ODEs, the model also keeps track of the cumulative number of cases (<span class="math inline">\(C\)</span>) and the cumulative number of disease-related deaths (<span class="math inline">\(D\)</span>) over time <span class="math display">\[\frac{\text{d}C_i}{\text{d}t} = \beta S_i \Sigma_{j}C_{ij} I_j,\]</span> <span class="math display">\[\frac{\text{d}D_i}{\text{d}t} = \mu I_i.\]</span></p>
<p>The system is closed by specifying the initial conditions <span class="math display">\[S(0) = S_0,\ E(0) = E_0,\ I(0) = I_0,\ R(0) = R_0,\ V(0) = V_0, VR(0) = VR_0,\ C(0) = 0,\ D(0) = 0.\]</span> In the implementation of the model in this package, the variables are normalized so <span class="math inline">\(S(t) + E(t) + I(t) + R(t) + V(t) + VR(t) + D(t) \equiv 1\)</span> for any given <span class="math inline">\(t\)</span>. This means that each of these state variables represents the fraction of the population in each of these states at a given point in time.</p>
<p>We next illustrate how this model works using functionality available in <code>comomodels</code>.</p>
</div>
<div class="section level2">
<h2 id="the-seirdvage-class">The <code>SEIRDVAge</code> class<a class="anchor" aria-label="anchor" href="#the-seirdvage-class"></a>
</h2>
</div>
<div class="section level2">
<h2 id="simulation-examples">Simulation examples<a class="anchor" aria-label="anchor" href="#simulation-examples"></a>
</h2>
<p>Now we create a model that includes this age-structured mixing. Since the contact matrices have 16 age classes, we instantiate a model with this number of classes. We also give it transmission parameters, populate the age classes with initial conditions and use our overall contact matrix.</p>
<p>We use country-level demographics from the UN and, for this example, initialise the model with a uniform initial infected population of 1% across all age groups. The remaining 99% of the population starts as susceptible.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/population.rda"</span><span class="op">)</span>
<span class="co"># use demographic data to create normalised population fractions</span>
<span class="va">pops</span> <span class="op">=</span> <span class="va">population</span><span class="op">[</span><span class="va">population</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">'India'</span>, <span class="op">]</span><span class="op">$</span><span class="va">pop</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pops</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pops</span><span class="op">)</span>
<span class="co">## the contact matrix has an upper group of 80+, so we sum the remaining fractions beyond this point</span>
<span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span><span class="op">)</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pop_fraction</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>
<span class="co"># reshape contact matrix into 16x16 form</span>
<span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fl">16</span>
<span class="va">c_combined_wider</span> <span class="op">&lt;-</span> <span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">age_infectee</span>, names_from <span class="op">=</span> <span class="va">age_infector</span>,
              values_from<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">age_infectee</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># create model</span>
<span class="va">my_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDVAge-class.html">SEIRDVAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                 contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                 age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Next, we set the parameter values for <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\nu\)</span>, <span class="math inline">\(\delta_V\)</span>, <span class="math inline">\(\delta_R\)</span> and <span class="math inline">\(\delta_{VR}\)</span>. For results inspired by the COVID pandemic, the mortality parameter <span class="math inline">\(\mu\)</span> is age-dependent as according to <a href="https://www.medrxiv.org/content/early/2020/03/13/2020.03.09.20033357" class="external-link">Verity (2020)</a>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.000016</span>, <span class="fl">0.000016</span>, <span class="fl">0.00007</span>, <span class="fl">0.00007</span>, <span class="fl">0.00031</span>, <span class="fl">0.00031</span>, <span class="fl">0.0026</span>, <span class="fl">0.0026</span>,
     <span class="fl">0.0048</span>, <span class="fl">0.0048</span>, <span class="fl">0.006</span>, <span class="fl">0.006</span>, <span class="fl">0.019</span>, <span class="fl">0.019</span>, <span class="fl">0.043</span>, <span class="fl">0.043</span><span class="op">)</span>

<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">1</span>, kappa<span class="op">=</span><span class="fl">0.9</span>, gamma<span class="op">=</span><span class="fl">0.5</span>, mu<span class="op">=</span><span class="va">mu</span>, nu<span class="op">=</span><span class="fl">0.4</span>, delta_V<span class="op">=</span><span class="fl">0.1</span>,
               delta_R<span class="op">=</span><span class="fl">0.05</span>, delta_VR <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params</span></code></pre></div>
<p>To check that the parameters have been set correctly, we call</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">)</span>
<span class="co">#&gt; $beta</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $kappa</span>
<span class="co">#&gt; [1] 0.9</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $gamma</span>
<span class="co">#&gt; [1] 0.5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $mu</span>
<span class="co">#&gt;  [1] 1.6e-05 1.6e-05 7.0e-05 7.0e-05 3.1e-04 3.1e-04 2.6e-03 2.6e-03 4.8e-03</span>
<span class="co">#&gt; [10] 4.8e-03 6.0e-03 6.0e-03 1.9e-02 1.9e-02 4.3e-02 4.3e-02</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $nu</span>
<span class="co">#&gt; [1] 0.4</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $delta_V</span>
<span class="co">#&gt; [1] 0.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $delta_R</span>
<span class="co">#&gt; [1] 0.05</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $delta_VR</span>
<span class="co">#&gt; [1] 0.02</span></code></pre></div>
<p>We now need to set the initial conditions for the model. We only set the initial conditions <span class="math inline">\(S(0)\)</span>, <span class="math inline">\(E(0)\)</span>, <span class="math inline">\(I(0)\)</span>, <span class="math inline">\(R(0)\)</span>, <span class="math inline">\(V(0)\)</span> and <span class="math inline">\(VR(0)\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.99</span>,
                                     E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                     I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.01</span>,
                                     R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                     V0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                     VR0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                     D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The initial conditions must sum to one. If they do not, an error is thrown.</p>
<p>Now we simulate the system from <span class="math inline">\(t=0\)</span> days to <span class="math inline">\(t=200\)</span> days.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">interven</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="va">n_ages</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_ages</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">150</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">190</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">120</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">180</span>
  <span class="op">}</span>
  <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">14</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">30</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">110</span>
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">-</span><span class="fl">7</span><span class="op">*</span><span class="va">i</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">190</span><span class="op">-</span><span class="fl">7</span><span class="op">*</span><span class="va">i</span>
  <span class="op">}</span>
  <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coverages</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="op">}</span>

<span class="fu"><a href="../reference/interventions.html">interventions</a></span><span class="op">(</span><span class="va">my_model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">interven</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">my_model</span>, <span class="va">times</span><span class="op">)</span></code></pre></div>
<p>The added intervention feature allows for variable levels of vaccination in a population. In most cases, a vaccine is not available or considered necessary right from the start of an epidemic so there is a delay in vaccination. Similarly, vaccination programs may not run at the same rate all the time, so such fluctuations need to be taken into account in our modeling. Vaccination levels and start times may differ between different age groups. In this instantiation of the model, vaccination of the each age group occurs at a different stage.</p>
<p>Below we can see a plot of the a classical level of interventions that occur at each time step.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">parameters</span> <span class="op">&lt;-</span> <span class="va">interven</span>

<span class="va">sim_parms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SimulationParameters-class.html">SimulationParameters</a></span><span class="op">(</span>start<span class="op">=</span><span class="fl">0</span>, stop<span class="op">=</span><span class="fl">200</span>, tstep <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="va">interventions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="va">n_ages</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_ages</span><span class="op">)</span><span class="op">{</span>
  <span class="va">int_parms</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/InterventionParameters-class.html">InterventionParameters</a></span><span class="op">(</span>start<span class="op">=</span><span class="va">parameters</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span>,
                                      stop<span class="op">=</span><span class="va">parameters</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span>,
                                      coverage<span class="op">=</span><span class="va">parameters</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coverages</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/intervention_protocol.html">intervention_protocol</a></span><span class="op">(</span><span class="va">int_parms</span>, <span class="va">sim_parms</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">coverage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"level of intervention for ages\n"</span>, <span class="va">age_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
          text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-1.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-2.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-3.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-4.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-5.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-6.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-7.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-8.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-9.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-10.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-11.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-12.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-13.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-14.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-15.png" width="672"><img src="SEIRDVAge_files/figure-html/unnamed-chunk-10-16.png" width="672"> Interventions for this model last several days at least and have several days between them.</p>
<p>The simulation returns two objects: one is a data frame comprising the states over time.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states</span> <span class="op">=</span> <span class="va">out_df</span><span class="op">$</span><span class="va">states</span>
<span class="va">changes</span> <span class="op">=</span> <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>  </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-11-1.png" width="672"> Zooming in on the infected population, we see that the younger age groups have the highest peak infected population levels. Moreover, the waning immunity feature allows for multiple peaks to occur in the number of infected, centered around 12.5, the second tailing right after the first one, and another wave beginning at around 160 and peaking towards the end of the time interval. For the younger age groups the number of daily infections remains somewhat constant until they drop around day 125.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
<p>The simulation also outputs incidence and deaths. These are derived from the state variables. Incidence is just the difference between the cumulative number of cases between two time points,</p>
<p><span class="math display">\[ \text{incidence(t)} = C(t) - C(t - 1),\]</span></p>
<p>since this shows the number of cases which have arisen between these time points. Deaths are also given by a difference, but, in this instance, between the cumulative number of deaths at two consecutive time points:</p>
<p><span class="math display">\[ \text{deaths(t)} = D(t) - D(t - 1).\]</span></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">changes</span> <span class="op">&lt;-</span> <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>

<span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Incidence"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/fig2-1.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/fig2-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="sensitivity-analysis">Sensitivity analysis<a class="anchor" aria-label="anchor" href="#sensitivity-analysis"></a>
</h2>
<p>In this section, we investigate the sensitivity of the number of deaths to the loss-of-immunity rate in recovered individuals who have also been vaccinated, <span class="math inline">\(\delta_{VR}\)</span>. We run the model for varying values of <span class="math inline">\(\delta_{VR}\)</span> and plot the number of deaths per day over time.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function to setup and run model for different delta_VR values</span>
<span class="va">run_SEIRDVAge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">delta_VR_val</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.99</span>, E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.01</span>,
                R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, V0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, VR0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">1</span>, kappa<span class="op">=</span><span class="fl">0.9</span>, gamma<span class="op">=</span><span class="fl">0.5</span>, mu<span class="op">=</span><span class="va">mu</span>, nu<span class="op">=</span><span class="fl">0.4</span>, delta_V<span class="op">=</span><span class="fl">0.1</span>,
                 delta_R<span class="op">=</span><span class="fl">0.05</span>, delta_VR <span class="op">=</span> <span class="va">delta_VR_val</span><span class="op">)</span>
  <span class="va">interv</span><span class="op">&lt;-</span> <span class="va">interven</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDVAge-class.html">SEIRDVAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>,
                initial_conditions <span class="op">=</span> <span class="va">inits</span>,
                transmission_parameters<span class="op">=</span><span class="va">params</span>,
                interventions <span class="op">=</span> <span class="va">interv</span><span class="op">)</span>
  <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span><span class="op">)</span>
  <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="op">}</span>

<span class="co"># run model across different delta_V values</span>
<span class="va">delta_VR_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.005</span>, <span class="fl">0.01</span>, <span class="fl">0.02</span>, <span class="fl">0.05</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">delta_VR_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">delta_VR_temp</span> <span class="op">&lt;-</span> <span class="va">delta_VR_vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">run_SEIRDVAge</span><span class="op">(</span><span class="va">delta_VR_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta_VR<span class="op">=</span><span class="va">delta_VR_temp</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta_VR<span class="op">=</span><span class="va">delta_VR_temp</span><span class="op">)</span>
  <span class="kw">else</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># plot results</span>
<span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">delta_VR</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population \n that died per day"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-13-1.png" width="672"> As we can see from the plot above, larger rates of immunity decay <span class="math inline">\(\delta_{VR}\)</span> in vaccinated recovered individuals make the second wave of the number of deaths in the epidemic have a higher peak. For <span class="math inline">\(\delta_{VR}&gt;0.01\)</span> a third wave starts to manifest after <span class="math inline">\(t=175\)</span>.</p>
<p>We now investigate the sensitivity of the number of deaths to the maximum vaccination rate, <span class="math inline">\(\nu\)</span>. We run the model for varying values of <span class="math inline">\(\nu\)</span> and plot the number of deaths per day over time.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function to setup and run model for different nu values</span>
<span class="va">run_SEIRDVAge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nu_val</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.99</span>, E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.01</span>,
                R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, V0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, VR0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">1</span>, kappa<span class="op">=</span><span class="fl">0.9</span>, gamma<span class="op">=</span><span class="fl">0.5</span>, mu<span class="op">=</span><span class="va">mu</span>,
                 nu<span class="op">=</span> <span class="va">nu_val</span>, 
                 delta_V<span class="op">=</span><span class="fl">0.1</span>, delta_R<span class="op">=</span><span class="fl">0.05</span>, delta_VR <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span>
  <span class="va">interv</span><span class="op">&lt;-</span> <span class="va">interven</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDVAge-class.html">SEIRDVAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>,
                initial_conditions <span class="op">=</span> <span class="va">inits</span>,
                transmission_parameters<span class="op">=</span><span class="va">params</span>,
                interventions <span class="op">=</span> <span class="va">interv</span><span class="op">)</span>
  <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span><span class="op">)</span>
  <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="op">}</span>

<span class="co"># run model across different nu values</span>
<span class="va">nu_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">10</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">nu_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">nu_temp</span> <span class="op">&lt;-</span> <span class="va">nu_vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">run_SEIRDVAge</span><span class="op">(</span><span class="va">nu_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nu<span class="op">=</span><span class="va">nu_temp</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nu<span class="op">=</span><span class="va">nu_temp</span><span class="op">)</span>
  <span class="kw">else</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># plot results</span>
<span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">nu</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population \n that died per day"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-14-1.png" width="672"> As we can see from the plot above, larger rates of maximum vaccination <span class="math inline">\(\nu\)</span> make the subsequent waves of the number of deaths in the epidemic peak lower. For <span class="math inline">\(\nu=10\)</span>, we see no deaths in most age groups between the first two waves. For the case when no vaccination occurs <span class="math inline">\(\nu=0\)</span> we see that the daily number of deaths remains relatively constant after the first wave and larger than for any of the other values analysed.</p>
<p>We now investigate the sensitivity of the start time of intervention values, <code>start_val</code>. We run the model for varying values of <code>start_val</code> and plot the number of deaths per day over time. The intervention profile is the same in each of the cases, only shifted by this quantity <code>start_val</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function to setup and run model for different start values</span>
<span class="va">var_interven</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start</span><span class="op">)</span><span class="op">{</span>
  <span class="va">interven</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="va">n_ages</span><span class="op">)</span>

  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_ages</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">150</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">190</span>
    <span class="op">}</span>
    <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">120</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">180</span>
    <span class="op">}</span>
    <span class="kw">else</span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">is.element</a></span><span class="op">(</span><span class="va">i</span>, <span class="fl">14</span><span class="op">:</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">30</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">110</span>
    <span class="op">}</span>
    <span class="kw">else</span><span class="op">{</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="fl">100</span><span class="op">-</span><span class="fl">7</span><span class="op">*</span><span class="va">i</span>
      <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span>  <span class="fl">190</span><span class="op">-</span><span class="fl">7</span><span class="op">*</span><span class="va">i</span>
    <span class="op">}</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">&lt;-</span> <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">starts</span> <span class="op">+</span> <span class="va">start</span>
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">&lt;-</span> <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">stops</span> <span class="op">+</span> <span class="va">start</span>
  
    <span class="va">interven</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">coverages</span> <span class="op">&lt;-</span> <span class="fl">1</span>
  <span class="op">}</span>

  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">interven</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">run_SEIRDVAge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">start_val</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">start</span> <span class="op">&lt;-</span> <span class="va">start_val</span>
  <span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.99</span>, E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.01</span>,
                R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, V0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, VR0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">1</span>, kappa<span class="op">=</span><span class="fl">0.9</span>, gamma<span class="op">=</span><span class="fl">0.5</span>, mu<span class="op">=</span><span class="va">mu</span>,
                 nu<span class="op">=</span> <span class="fl">0.4</span>, delta_V<span class="op">=</span><span class="fl">0.1</span>, delta_R<span class="op">=</span><span class="fl">0.05</span>, delta_VR <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span>
  <span class="va">interv</span><span class="op">&lt;-</span> <span class="fu">var_interven</span><span class="op">(</span>start <span class="op">=</span> <span class="va">start_val</span><span class="op">)</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDVAge-class.html">SEIRDVAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>,
                initial_conditions <span class="op">=</span> <span class="va">inits</span>,
                transmission_parameters<span class="op">=</span><span class="va">params</span>,
                interventions <span class="op">=</span> <span class="va">interv</span><span class="op">)</span>
  <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span><span class="op">)</span>
  <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="op">}</span>

<span class="co"># run model across different nu values</span>
<span class="va">start_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">40</span>, <span class="fl">75</span>, <span class="fl">94</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">start_vals</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">start_temp</span> <span class="op">&lt;-</span> <span class="va">start_vals</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">run_SEIRDVAge</span><span class="op">(</span><span class="va">start_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>start<span class="op">=</span><span class="va">start_temp</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>start<span class="op">=</span><span class="va">start_temp</span><span class="op">)</span>
  <span class="kw">else</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># plot results</span>
<span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">start</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population \n that died per day"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-15-1.png" width="672"> As we can see from the plot above, larger start time of intervention values, <code>start_val</code> make the second wave riding of the tail of the first one last plateau for longer and at a higher level.</p>
<p>We will compare now the two possible scenarios when we make the intervention the age-dependent and the case when we apply the same protocol of vaccination regardless of age groups.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># function to setup and run model for different delta_VR values</span>
<span class="va">run_SEIRDVAge</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">interv_type</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.99</span>, E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.01</span>,
                R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, V0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>, VR0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
  <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta<span class="op">=</span><span class="fl">1</span>, kappa<span class="op">=</span><span class="fl">0.9</span>, gamma<span class="op">=</span><span class="fl">0.5</span>, mu<span class="op">=</span><span class="va">mu</span>, nu<span class="op">=</span><span class="fl">0.4</span>, delta_V<span class="op">=</span><span class="fl">0.1</span>,
                 delta_R<span class="op">=</span><span class="fl">0.05</span>, delta_VR <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">interv_type</span> <span class="op">==</span> <span class="st">'distinct'</span><span class="op">)</span><span class="op">{</span>
    <span class="va">interv</span><span class="op">&lt;-</span> <span class="va">interven</span>
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">interv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>starts<span class="op">=</span><span class="fl">50</span>,
                   stops<span class="op">=</span><span class="fl">140</span>,
                   coverages<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDVAge-class.html">SEIRDVAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>,
                initial_conditions <span class="op">=</span> <span class="va">inits</span>,
                transmission_parameters<span class="op">=</span><span class="va">params</span>,
                interventions <span class="op">=</span> <span class="va">interv</span><span class="op">)</span>
  <span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
  <span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span><span class="op">)</span>
  <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="op">}</span>

<span class="co"># run model across different intervention types</span>
<span class="va">interv_types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'distinct'</span>, <span class="st">'common'</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">interv_types</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">interv_type_temp</span> <span class="op">&lt;-</span> <span class="va">interv_types</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>
  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">run_SEIRDVAge</span><span class="op">(</span><span class="va">interv_type_temp</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interv_type<span class="op">=</span><span class="va">interv_type_temp</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">temp</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>interv_type<span class="op">=</span><span class="va">interv_type_temp</span><span class="op">)</span>
  <span class="kw">else</span>
    <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># plot results</span>
<span class="va">result</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">interv_type</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population \n that died per day"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRDVAge_files/figure-html/unnamed-chunk-16-1.png" width="672"> In the case of a <code>common</code> vaccination protocol for all age groups, not only is the first peak of the number of deaths higher than in the case of age-specific interventions, but the second peak tailing the first is also more pronounced and lasts longer and the third wave occurs sooner and is also higher in amplitude then for the <code>distinct</code> interventions case.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sumali Bajaj, Fergus Cooper.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
