<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="comomodels">
<title>Urban and rural metapopulations model • comomodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Urban and rural metapopulations model">
<meta property="og:description" content="comomodels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">comomodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/SEIRD_age_structured.html">Age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIaImIsRD.html">Asymptomatic, mild and severe symptom compartment model</a>
    <a class="dropdown-item" href="../articles/SEIRDNPIAge.html">NPIs: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD.html">SEIRD model</a>
    <a class="dropdown-item" href="../articles/SEIRDV.html">Vaccinations model</a>
    <a class="dropdown-item" href="../articles/SEIRDVAge.html">Vaccinations: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD_rural_urban.html">Urban and rural metapopulations model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="SEIRD_rural_urban_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Urban and rural metapopulations model</h1>
                        <h4 data-toc-skip class="author">Solveig A. van der Vegt</h4>
            
      
      
      <div class="d-none name"><code>SEIRD_rural_urban.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">comomodels</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape" class="external-link">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: viridisLite</span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here we consider an extension to the basic SEIRD model that considers multiple interacting communities. For simplicity, we consider only two interacting communities here. Each community consists of a susceptible, exposed, infectious and recovered population. Although one can consider two generic communities, in this implementation we consider specifically one urban and one rural community, and use data from the WHO and UN to specify contacts in each community. In the following sections, we will explain the equations of the model, the implementation in this package and how to use it, and discuss briefly how the connectedness level between communities affects the results.</p>
</div>
<div class="section level2">
<h2 id="the-mathematical-model">The mathematical model<a class="anchor" aria-label="anchor" href="#the-mathematical-model"></a>
</h2>
<div class="section level3">
<h3 id="the-equations">The equations<a class="anchor" aria-label="anchor" href="#the-equations"></a>
</h3>
<p>We base our model of connected communities on the model presented by Tun et al. <span class="citation">(2021)</span>. We designate the urban community <span class="math inline">\(U\)</span> and the rural community <span class="math inline">\(Y\)</span>. Following the same naming pattern for variables and parameters as used for the basic SEIRD model, the ordinary differential equations describing how the populations evolve are as follows, where variable <span class="math inline">\(X_Z\)</span> (for <span class="math inline">\(X \in \{S,E,I,R\}, Z \in \{U, Y\}\)</span>) designates the population of individuals with infectedness status <span class="math inline">\(X\)</span> in community <span class="math inline">\(Z\)</span>,</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
    \frac{\text{d}S_U}{\text{d}t} = &amp;-\beta S_U \left((I_U+I_Y) (\phi_U N_U + \phi_Y N_Y) C + \frac{I_U}{\phi_U}N_U(1-C)\right),\\
    \frac{\text{d}S_Y}{\text{d}t} = &amp;-\beta S_Y \left((I_U+I_Y) (\phi_U N_U + \phi_Y N_Y) C + \frac{I_Y}{\phi_Y}N_Y(1-C)\right),\\
    \frac{\text{d}E_U}{\text{d}t} = &amp;  \beta S_U \left((I_U+I_Y) (\phi_U N_U + \phi_Y N_Y) C + \frac{I_U}{\phi_U}N_U(1-C)\right) - \kappa E_U,\\
    \frac{\text{d}E_Y}{\text{d}t} = &amp; \beta S_Y \left((I_U+I_Y) (\phi_U N_U + \phi_Y N_Y) C + \frac{I_Y}{\phi_Y}N_Y(1-C)\right)  - \kappa E_Y,\\
    \frac{\text{d}I_U}{\text{d}t} = &amp; \kappa E_U - (\gamma + \mu)I_U ,\\
    \frac{\text{d}I_Y}{\text{d}t} = &amp; \kappa E_Y - (\gamma + \mu)I_Y,\\
    \frac{\text{d}R_U}{\text{d}t} = &amp; \gamma I_U,\\
    \frac{\text{d}R_Y}{\text{d}t} = &amp; \gamma I_Y,\\
    \frac{\text{d}D_U}{\text{d}t} = &amp; \mu I_U,\\
    \frac{\text{d}D_Y}{\text{d}t} = &amp; \mu I_Y.\\
\end{split}
\end{equation}\]</span></p>
<p>In the above equations, <span class="math inline">\(\phi_U\)</span> is the fraction of the population that lives in an urban environment, <span class="math inline">\(\phi_Y\)</span> is the fraction of the population that lives in a rural environment, <span class="math inline">\(N_U\)</span> is the average number of contacts that an urban individual has in a day, and <span class="math inline">\(N_Y\)</span> is the average number of contacts that a rural individual has in a day, so <span class="math inline">\((\phi_U N_U + \phi_Y N_Y)\)</span> is the average number of contacts for any individual. <span class="math inline">\(C\)</span> is the connectedness parameter, where <span class="math inline">\(C=1\)</span> means the communities are well-mixed with each other, and <span class="math inline">\(C=0\)</span> means the two communities do not interact at all.</p>
<p>The difference between this model and the basic SEIRD model is the computation of the number of infectious contacts that a susceptible individual has. This is reflected in the equations for <span class="math inline">\(S_Z\)</span> and <span class="math inline">\(E_Z\)</span>. Individuals in either community can either come into contact with people from their own community or from the other community. The extent to which the latter happens is determined by the connectedness parameter <span class="math inline">\(C\)</span>. If the communities are completely separate, i.e. <span class="math inline">\(C=0\)</span>, the probability that a susceptible individual in community <span class="math inline">\(Z\)</span> interacts with an infectious individual is the number of contacts that someone in that community has, <span class="math inline">\(N_Z\)</span>, multiplied by the probability that a contact is infectious, <span class="math inline">\(I_Z/\phi_Z\)</span>. If the communities are well-mixed with each other, the probability is again the number of contacts multiplied by the probability that a contact is infectious, although now the number of contacts that an individual has is averaged over the communities, so <span class="math inline">\(\phi_U N_U + \phi_Y N_Y\)</span>, and the individual can encounter people from either community so the probability of an infectious contact is <span class="math inline">\(I_U+I_Y\)</span>. The extent to which the communities are connected, designated by <span class="math inline">\(C\)</span>, determines to which extent the two extreme contact patterns play a role, and thus we obtain the weighted average that appears in the equations above which designates the total probability of a susceptible individual in <span class="math inline">\(Z\)</span> having an infectious contact: <span class="math inline">\((I_U+I_Y) (\phi_U N_U + \phi_Y N_Y) C + \frac{I_Z}{\phi_Z}N_Z(1-C)\)</span>.</p>
</div>
<div class="section level3">
<h3 id="the-contact-parameters-n_z">The contact parameters <span class="math inline">\(N_Z\)</span><a class="anchor" aria-label="anchor" href="#the-contact-parameters-n_z"></a>
</h3>
<p>The average number of contacts for an individual in a given community <span class="math inline">\(Z\)</span>, <span class="math inline">\(N_Z\)</span>, is computed based on the country-specific contact matrices <span class="citation">(Prem et al. 2020)</span>, age demographics <span class="citation">(“World Population Prospects 2019, Online Edition. Rev. 1” 2019)</span>, and urban/rural populations split <span class="citation">(“Rural Population (% of Total Population)” 2018)</span>. For a detailed discussion of the contact matrices, see the age-structured model. The number of contacts in community <span class="math inline">\(Z\)</span> of a specific country is computed by first adding up all the contacts in the contact matrix for each age group so we obtain the total number of contacts that an individual in a specific age group has in a day. We obtain the vector with population by age for community <span class="math inline">\(Z\)</span> by taking the age demographic data for the whole country and multiplying it by the fraction of the population that lives in community <span class="math inline">\(Z\)</span>. We then take a weighted average over the age groups, using the age demographic data as weights. Lastly, we divide the number of contacts by the total population size to normalize the number of contacts (all populations in the model are normalized). We thus get <span class="math display">\[\begin{equation}
    N_{Z} = \frac{ \sum_{m = 1}^K c_Z(n,m)\cdot y_Z}{\text{total population}}, 
\end{equation}\]</span> where <span class="math inline">\(c_Z(n,m)\)</span> is the entry in contact matrix <span class="math inline">\(c\)</span> for community <span class="math inline">\(Z\)</span> denoting the number of contacts someone in age group <span class="math inline">\(n\)</span> has with individuals in age group <span class="math inline">\(m\)</span>, and <span class="math inline">\(y_Z\)</span> is the vector designating the number of individuals in each age group in community <span class="math inline">\(Z\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="implementation-and-use">Implementation and use<a class="anchor" aria-label="anchor" href="#implementation-and-use"></a>
</h2>
<p>In this section, we walk through how to use the model. First, we will show how to load and prep the appropriate data, which is included in the package. We’ll then walk through an example simulation. In the last subsection, we’ll briefly discuss the effect of varying the connectedness parameter <span class="math inline">\(C\)</span>.</p>
<div class="section level3">
<h3 id="loading-and-prepping-country-specific-data">Loading and prepping country-specific data<a class="anchor" aria-label="anchor" href="#loading-and-prepping-country-specific-data"></a>
</h3>
<p>First, we load the contact matrices for the urban and rural communities. Because the two sets of contact matrices don’t cover the exact same countries, we also make a list of countries for which we have both contact matrices, which we can use later to check if the choice of country is valid.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load contact matrices</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/contact_all_urban.rda"</span><span class="op">)</span> <span class="co"># ROWS are age of person, COLUMNS are age of contact</span>
<span class="va">names_urban</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">contact_all_urban</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/contact_all_rural.rda"</span><span class="op">)</span>
<span class="va">names_rural</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">contact_all_rural</span><span class="op">)</span>
<span class="va">names_common</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">names_urban</span>,<span class="va">names_rural</span><span class="op">)</span></code></pre></div>
<p>We also load in all demographic data, and load in a list showing the three-letter code for each country.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#import all demographic data</span>
<span class="co"># data on percentage of the population that is rural</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/percentrural_by_country.rda"</span><span class="op">)</span>
<span class="co"># age demographic breakdown into 5 year age categories</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/agedemographics_by_country.rda"</span><span class="op">)</span>
<span class="co"># conversion table from 3 letter country codes to full names</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"../data/country_codetoname.rda"</span><span class="op">)</span></code></pre></div>
<p>Next, we select a country, in this case Tunisia. This needs to happen with a three letter code. We check if the country is valid choice by checking if it appears in the list of countries for which we have both a rural and urban contact matrix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify country</span>
<span class="va">country</span> <span class="op">&lt;-</span> <span class="st">"TUN"</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">names_common</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">country</span>,<span class="st">" is not a valid three-letter country code."</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now that we have specified a country, we extract from the data what percentage of its population is rural. Because the most recent year that all our data source have in common is 2019, we select all our data from that year.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get fraction of population that is rural</span>
<span class="va">country_rural</span> <span class="op">&lt;-</span> <span class="va">percentrural_by_country</span><span class="op">$</span><span class="va">`2019`</span><span class="op">[</span><span class="va">percentrural_by_country</span><span class="op">$</span><span class="va">`Country Code`</span> <span class="op">==</span> <span class="va">country</span><span class="op">]</span>
<span class="va">frac_rural</span> <span class="op">&lt;-</span> <span class="va">country_rural</span><span class="op">/</span><span class="fl">100</span> <span class="co">#turn percentage into fraction</span></code></pre></div>
<p>The last step in our data prep is to create the vector of normalized population per age group for the specific country. The contact matrices have 5-year age groups with the oldest group being 80+. Because the age demographics go up to 100+, we need to sum the last five age groups in the demographics vector to ensure compatibility with the contact matrices.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get fraction of population in each 5-year age range</span>
<span class="co"># get full name of country</span>
<span class="va">country_fullname</span> <span class="op">&lt;-</span> <span class="va">country_codetoname</span><span class="op">$</span><span class="va">CountryName</span><span class="op">[</span><span class="va">country_codetoname</span><span class="op">$</span><span class="va">CountryCode</span> <span class="op">==</span> <span class="va">country</span><span class="op">]</span>
<span class="co"># extract age demographic vector</span>
<span class="va">pop_byage_2019</span> <span class="op">&lt;-</span> <span class="va">agedemographics_by_country</span><span class="op">[</span><span class="op">(</span><span class="va">agedemographics_by_country</span><span class="op">$</span><span class="va">`Region, subregion, country or area *`</span> <span class="op">==</span> <span class="va">country_fullname</span>
                                     <span class="op">&amp;</span> <span class="va">agedemographics_by_country</span><span class="op">$</span><span class="va">`Reference date (as of 1 July)`</span> <span class="op">==</span> <span class="fl">2019</span><span class="op">)</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span>
<span class="va">pop_byage_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">as.double</a></span><span class="op">(</span><span class="va">pop_byage_2019</span><span class="op">)</span>
<span class="co"># normalize to fractions of the total population</span>
<span class="va">pop_byage_2019</span> <span class="op">&lt;-</span> <span class="va">pop_byage_2019</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop_byage_2019</span><span class="op">)</span> 
<span class="co"># must sum last five entries because contact matrices have an 80+ category instead of 100+</span>
<span class="va">pop_byage_2019</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pop_byage_2019</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop_byage_2019</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basic-simulation">Basic simulation<a class="anchor" aria-label="anchor" href="#basic-simulation"></a>
</h3>
<p>We start by creating an instance of the model class,</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRD_RU-class.html">SEIRD_RU</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>followed by setting the parameter values of the model that are not determined by the demographics or contact matrices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b</span> <span class="op">=</span> <span class="fl">0.3</span> <span class="co"># probability of infection</span>
<span class="va">k</span> <span class="op">=</span> <span class="fl">0.2</span> <span class="co"># 1/(incubation period in days)</span>
<span class="va">g</span> <span class="op">=</span> <span class="fl">0.1</span><span class="co"># 1/(days between infection and recovery)</span>
<span class="va">m</span> <span class="op">=</span> <span class="fl">0.03</span> <span class="co"># probability of death, cases-fatality ratio.</span>
<span class="va">C</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># connectedness parameter</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">k</span>, <span class="va">g</span>, <span class="va">m</span>, <span class="va">C</span><span class="op">)</span></code></pre></div>
<p>Next we set the initial conditions of the model, where we specify separately what fraction of the population is infected in the urban community and what fraction is infected in the rural community. Note here that these are fractions of the total population across both communities! Because the populations are normalized, all initial conditions together must sum to one. In this example, we seed the epidemic in the urban community.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">start_infected_urban</span> <span class="op">=</span> <span class="fl">0.0001</span>
<span class="va">start_infected_rural</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">S0U</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">frac_rural</span> <span class="op">-</span> <span class="va">start_infected_urban</span>
<span class="va">E0U</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">I0U</span> <span class="op">=</span> <span class="va">start_infected_urban</span>
<span class="va">R0U</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">S0Y</span> <span class="op">=</span> <span class="va">frac_rural</span> <span class="op">-</span> <span class="va">start_infected_rural</span>
<span class="va">E0Y</span> <span class="op">=</span> <span class="fl">0</span>
<span class="va">I0Y</span> <span class="op">=</span> <span class="va">start_infected_rural</span>
<span class="va">R0Y</span> <span class="op">=</span> <span class="fl">0</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">S0U</span>, <span class="va">E0U</span>, <span class="va">I0U</span>, <span class="va">R0U</span>,
                                        <span class="va">S0Y</span>, <span class="va">E0Y</span>, <span class="va">I0Y</span>, <span class="va">R0Y</span><span class="op">)</span></code></pre></div>
<p>In this implementation of the SEIRD model with two communities, there are several options for inputting data about the age demographics of the communities and the contacts they have. You can choose to use the data sets in this package that provide this information for specific countries. Note that is you want to do this, i.e. use contact matrices and demographic data, it is essential that you set the demographic data BEFORE entering the contact matrices. This is done via the code below. The number of contacts and fraction of the population that live in a rural environment are calculated for you.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#set demographic data</span>
<span class="fu"><a href="../reference/country_demog.html">country_demog</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pop_byage_2019</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">frac_rural</span><span class="op">)</span>,<span class="va">pop_byage_2019</span><span class="op">*</span><span class="va">frac_rural</span><span class="op">)</span>

<span class="co"># set contact matrices</span>
<span class="fu"><a href="../reference/contact_rates.html">contact_rates</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">contact_all_urban</span><span class="op">[[</span><span class="va">country</span><span class="op">]</span><span class="op">]</span>,<span class="va">contact_all_rural</span><span class="op">[[</span><span class="va">country</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Instead of using the data sets you can also choose to set the contact rates and the fraction of the population that is rural yourself. This is done by assigning the fraction rural, a single number which between 0 and 1, directly to country_demog(model), and assigning a list of two values to contact_rates(model). Note that if you wish to use contact matrices, full age demographic data is required, but you are free to use age demographic data and set the contact rates manually.</p>
<p>The last thing to do is to set the time span over which to simulate the model, and then run it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tend</span> <span class="op">=</span> <span class="fl">80</span>
<span class="va">time</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">tend</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># run simulation</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">time</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span>
<span class="co">#&gt; [1] 972   4</span></code></pre></div>
<p>The output from the model can then be plotted such that all populations are plotted separately for both communities</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Communities plotted separately</span>
<span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">is.factor</span><span class="op">)</span>
<span class="va">output</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">output</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="va">as.character</span><span class="op">)</span>
<span class="va">SEIR_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Incidences_U"</span> <span class="op">&amp;</span> <span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Deaths_U"</span> <span class="op">&amp;</span> <span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Incidences_Y"</span> <span class="op">&amp;</span> <span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Deaths_Y"</span><span class="op">)</span>
<span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_U"</span>, <span class="st">"E_U"</span>, <span class="st">"I_U"</span>, <span class="st">"R_U"</span>, <span class="st">"S_Y"</span>, <span class="st">"E_Y"</span>, <span class="st">"I_Y"</span>, <span class="st">"R_Y"</span><span class="op">)</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_U"</span> <span class="op">=</span> <span class="st">"blue"</span>, <span class="st">"E_U"</span> <span class="op">=</span> <span class="st">"green"</span>, <span class="st">"I_U"</span> <span class="op">=</span> <span class="st">"yellow"</span>, <span class="st">"R_U"</span> <span class="op">=</span> <span class="st">"red"</span>, <span class="st">"S_Y"</span> <span class="op">=</span> <span class="st">"lightskyblue1"</span>, <span class="st">"E_Y"</span> <span class="op">=</span> <span class="st">"lightgreen"</span>, <span class="st">"I_Y"</span> <span class="op">=</span> <span class="st">"lightyellow"</span>, <span class="st">"R_Y"</span> <span class="op">=</span> <span class="st">"indianred"</span><span class="op">)</span>
<span class="va">SEIRplot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">SEIR_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">compartment</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">col</span><span class="op">)</span>

<span class="va">case_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">output</span>, <span class="va">compartment</span> <span class="op">==</span> <span class="st">"Incidences_U"</span> <span class="op">|</span> <span class="va">compartment</span> <span class="op">==</span> <span class="st">"Deaths_U"</span> <span class="op">|</span> <span class="va">compartment</span> <span class="op">==</span> <span class="st">"Incidences_Y"</span> <span class="op">|</span> <span class="va">compartment</span> <span class="op">==</span> <span class="st">"Deaths_Y"</span><span class="op">)</span>
<span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Incidences_U"</span>, <span class="st">"Deaths_U"</span>, <span class="st">"Incidences_Y"</span>, <span class="st">"Deaths_Y"</span><span class="op">)</span><span class="op">)</span>
<span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cases_U"</span> <span class="op">=</span> <span class="st">"grey28"</span>, <span class="st">"Deaths_U"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Cases_Y"</span> <span class="op">=</span> <span class="st">"lightgray"</span>, <span class="st">"Deaths_Y"</span> <span class="op">=</span> <span class="st">"darkgray"</span><span class="op">)</span>
<span class="va">inc_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">case_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">compartment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_fill_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cases_U"</span>,<span class="st">"Deaths_U"</span>,<span class="st">"Cases_Y"</span>,<span class="st">"Deaths_Y"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">SEIRplot</span>,<span class="va">inc_plot</span>,nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_rural_urban_files/figure-html/unnamed-chunk-12-1.png" width="672"> or such that the populations are summed across the communities and we can observe the dynamics of the susceptible, exposed, infectious, recovered and dead individuals in the whole population.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SEIR_total</span> <span class="op">&lt;-</span> <span class="va">SEIR_df</span>
<span class="va">CD_total</span> <span class="op">&lt;-</span> <span class="va">case_df</span>

<span class="va">SEIR_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"S_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"S_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"S_Y"</span><span class="op">]</span>
<span class="va">SEIR_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"E_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"E_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"E_Y"</span><span class="op">]</span>
<span class="va">SEIR_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"I_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"I_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"I_Y"</span><span class="op">]</span>
<span class="va">SEIR_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"R_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"R_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">SEIR_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">SEIR_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"R_Y"</span><span class="op">]</span>
<span class="va">CD_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">CD_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Incidences_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">case_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Incidences_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">case_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Incidences_Y"</span><span class="op">]</span>
<span class="va">CD_total</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">CD_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Deaths_U"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">case_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Deaths_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">case_df</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">case_df</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"Deaths_Y"</span><span class="op">]</span> 

<span class="va">SEIR_total</span> <span class="op">&lt;-</span> <span class="va">SEIR_total</span><span class="op">[</span><span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"S_Y"</span> <span class="op">&amp;</span> <span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"E_Y"</span> <span class="op">&amp;</span> <span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"I_Y"</span> <span class="op">&amp;</span> <span class="va">SEIR_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"R_Y"</span>,<span class="op">]</span>
<span class="va">CD_total</span> <span class="op">&lt;-</span> <span class="va">CD_total</span><span class="op">[</span><span class="va">CD_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Incidences_Y"</span> <span class="op">&amp;</span> <span class="va">CD_total</span><span class="op">$</span><span class="va">compartment</span> <span class="op">!=</span> <span class="st">"Deaths_Y"</span>,<span class="op">]</span>

<span class="va">SEIRplot_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">SEIR_total</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">compartment</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_colour_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Total S"</span>, <span class="st">" Total E"</span>,<span class="st">"Total I"</span>,<span class="st">"Total R"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="va">incplot_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CD_total</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, fill <span class="op">=</span> <span class="va">compartment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_fill_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cases"</span>,<span class="st">"Deaths"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html" class="external-link">grid.arrange</a></span><span class="op">(</span><span class="va">SEIRplot_total</span>,<span class="va">incplot_total</span>,nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_rural_urban_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="the-basic-reproduction-number-r0">The basic reproduction number: R0<a class="anchor" aria-label="anchor" href="#the-basic-reproduction-number-r0"></a>
</h3>
<p>We can compute the basic reproduction number using the next generation matrix method explained by van den Driessche <span class="citation">(2017)</span>. The basic reproduction for the model can be displayed by simply calling</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="../reference/R0.html">R0</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 15.84567</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-effect-of-varying-c">The effect of varying <span class="math inline">\(C\)</span><a class="anchor" aria-label="anchor" href="#the-effect-of-varying-c"></a>
</h2>
<p>The connectedness parameter <span class="math inline">\(C\)</span> indicates how connected the two communities are, i.e. how much the individuals in each are expected to interact with each other. At the extreme ends we have the communities completely connected and acting as one big community for <span class="math inline">\(C=1\)</span>, and completely disconnected and acting as separate communities for <span class="math inline">\(C=0\)</span>. We explore what happens for intermediate values by simulating the model for a range of values of <span class="math inline">\(C\)</span> and plotting the total infectious population over both communities for each simulation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R">  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.001</span>,<span class="fl">0.005</span>,<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">C</span> <span class="op">=</span> <span class="va">i</span> <span class="co"># connectedness parameter</span>
    <span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">b</span>, <span class="va">k</span>, <span class="va">g</span>, <span class="va">m</span>, <span class="va">C</span><span class="op">)</span>
    <span class="va">out_C</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">time</span><span class="op">)</span>
    <span class="va">temp_I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>C <span class="op">=</span> <span class="va">C</span>, t <span class="op">=</span> <span class="va">time</span>,compartment <span class="op">=</span> <span class="st">"U"</span>,value <span class="op">=</span> <span class="va">out_C</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">out_C</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"I_U"</span><span class="op">]</span> <span class="op">+</span> <span class="va">out_C</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">out_C</span><span class="op">$</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"I_Y"</span><span class="op">]</span><span class="op">)</span>
    <span class="co">#temp_IY &lt;- data.frame(Cvalue = C, t = time,compartment = "Y",value = out_C$value[out_C$compartment == "I_Y"])</span>
    <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span><span class="op">{</span>
      <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">temp_I</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
      <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">result</span>,<span class="va">temp_I</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">result</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">C</span><span class="op">)</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"C"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_rural_urban_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p>The above plot shows that up to approximately <span class="math inline">\(C=0.1\)</span>, the value of <span class="math inline">\(C\)</span> has a significant impact on total number of infectious individuals across the communities. Varying the value of <span class="math inline">\(C\)</span> between 0.1 and one, however, barely makes a difference. As both communities are subject to the same parameter values and the average number of contacts that individuals in both communities have don’t differ a lot in most countries, this result is not surprising. Above a certain level of interaction, the few infectious people in one community will quickly interact with individuals from the other community, spreading the infection. At that point, both communities develop their own epidemic under the same parameter values and the mixing between them further helps in synchronizing the waves of the epidemic in both communities. Only for very low levels of interaction does the initial difference in the number of infectious individuals have a lasting effect on epidemic dynamics.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-Prem20">
<p>Prem, Kiesha, Kevin van Zandvoort, Petra Klepac, Rosalind M Eggo, Nicholas G Davies, Alex R Cook, and Mark Jit. 2020. “Projecting Contact Matrices in 177 Geographical Regions: An Update and Comparison with Empirical Data for the Covid-19 Era.” <em>medRxiv</em>. <a href="https://doi.org/10.1101/2020.07.22.20159772" class="external-link">https://doi.org/10.1101/2020.07.22.20159772</a>.</p>
</div>
<div id="ref-WB">
<p>“Rural Population (% of Total Population).” 2018. <em>Data</em>. The World Bank. <a href="https://data.worldbank.org/indicator/SP.RUR.TOTL.ZS" class="external-link">https://data.worldbank.org/indicator/SP.RUR.TOTL.ZS</a>.</p>
</div>
<div id="ref-Tun21">
<p>Tun, Sai Thein Than, Daniel M. Parker, Ricardo Aguas, and Lisa J. White. 2021. “The Assembly Effect: The Connectedness Between Populations Is a Double-Edged Sword for Public Health Interventions.” <em>Malaria Journal</em> 20 (1): 189. <a href="https://doi.org/10.1186/s12936-021-03726-x" class="external-link">https://doi.org/10.1186/s12936-021-03726-x</a>.</p>
</div>
<div id="ref-vandenDriessche17">
<p>van den Driessche, Pauline. 2017. “Reproduction Numbers of Infectious Disease Models.” <em>Infectious Disease Modelling</em> 2 (3): 288–303. <a href="https://doi.org/10.1016/j.idm.2017.06.002" class="external-link">https://doi.org/10.1016/j.idm.2017.06.002</a>.</p>
</div>
<div id="ref-UN">
<p>“World Population Prospects 2019, Online Edition. Rev. 1.” 2019. United Nations, Department of Economic; Social Affairs, Population Division (2019). <a href="https://population.un.org/wpp/Download/Standard/Population/" class="external-link">https://population.un.org/wpp/Download/Standard/Population/</a>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Sumali Bajaj, Fergus Cooper.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
