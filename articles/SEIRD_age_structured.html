<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="comomodels">
<title>Age-structured model • comomodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Age-structured model">
<meta property="og:description" content="comomodels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">comomodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/SEIRD_age_structured.html">Age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIaImIsRD.html">Asymptomatic, mild and severe symptom compartment model</a>
    <a class="dropdown-item" href="../articles/SEIRD_BD.html">Births and natural deaths and waning natural immunity</a>
    <a class="dropdown-item" href="../articles/SEIRDNPIAge.html">NPIs: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD_CT.html">NPIs: contact tracing and quarantining</a>
    <a class="dropdown-item" href="../articles/SEIRD.html">SEIRD model</a>
    <a class="dropdown-item" href="../articles/SEIRDV.html">Vaccinations model</a>
    <a class="dropdown-item" href="../articles/SEIRDVAge.html">Vaccinations: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD_rural_urban.html">Urban and rural metapopulations model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="SEIRD_age_structured_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Age-structured model</h1>
                        <h4 data-toc-skip class="author">Oscar Dimdore-Miles, Ioana Bouros and Ben Lambert</h4>
            
      
      
      <div class="d-none name"><code>SEIRD_age_structured.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <a href="https://github.com/Como-DTC-Collaboration/como-models/blob/main/vignettes/SEIRD.Rmd" class="external-link">basic SEIRD model</a> assumes that individuals with the same infection status behave identically and that the infection has the same effect. In reality, however, individuals with the same infection status may differ substantively. In particular, individuals’ age is likely to correlate with both social differences – for example, a teenager may mix with more people per day than an elderly person – and biological differences – for example, the severity of illness may, on average, be generally worse in the elderly (as is known to be the case for COVID-19 <span class="citation">(Verity et al. 2020)</span>).</p>
<p>Models which allow varying transmission dynamics for different age groups can capture these differences, and this document explains the basics of an age-structured SEIRD model. The model describes how populations of susceptible, exposed, infectious, recovered and dead individuals evolve over time. In this model, each age class, <span class="math inline">\(i\)</span>, has its own system of five coupled differential equations governing movements between these compartments. If age classes did not interact with one another, these set of equations would simply follow the basic SEIRD dynamics:</p>
<p><span class="math display">\[\begin{align}
\frac{\text{d}S_i}{\text{d}t} &amp;= -\beta S_i I_i\\
\frac{\text{d}E_i}{\text{d}t} &amp;= \beta S_i I_i -\kappa E_i\\
\frac{\text{d}I_i}{\text{d}t} &amp;= \kappa E_i - (\gamma + \mu) I_i\\
\frac{\text{d}R_i}{\text{d}t} &amp;= \gamma I_i\\
\frac{\text{d}D_i}{\text{d}t} &amp;= \mu I_i.
\end{align}\]</span></p>
<p>This system of ODEs could then be solved independently for each age group <span class="math inline">\(i\)</span>, and each of their dynamics would be the same as for the non-age-structured SEIRD model. Additionally, infection transmission through each of the age classes would be identical, aside from any differences in the initial conditions of each compartment.</p>
</div>
<div class="section level2">
<h2 id="age-dependent-mortality">Age-dependent mortality<a class="anchor" aria-label="anchor" href="#age-dependent-mortality"></a>
</h2>
<p>For COVID-19 transmission, a key difference is that the death rate varies by age. In <span class="citation">Verity et al. (2020)</span>, the infection fatality ratio – the proportion of infected individuals who die – was shown to vary strongly with age using aggregate case and deaths data for mainland China until March 2020. Here we graph their estimates. From this, we see the dramatic rise in the risk of death beginning at around the 50-59 age class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># for 80+ group we pick upper age to be 110</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">lower_age</span>, <span class="op">~</span><span class="va">upper_age</span>, <span class="op">~</span><span class="va">IFR</span>,
  <span class="fl">0</span>, <span class="fl">9</span>, <span class="fl">0.00161</span>,
  <span class="fl">10</span>, <span class="fl">19</span>, <span class="fl">0.00695</span>,
  <span class="fl">20</span>, <span class="fl">29</span>, <span class="fl">0.0309</span>,
  <span class="fl">30</span>, <span class="fl">39</span>, <span class="fl">0.0844</span>,
  <span class="fl">40</span>, <span class="fl">49</span>, <span class="fl">0.161</span>,
  <span class="fl">50</span>, <span class="fl">59</span>, <span class="fl">0.595</span>,
  <span class="fl">60</span>, <span class="fl">69</span>, <span class="fl">1.93</span>,
  <span class="fl">70</span>, <span class="fl">79</span>, <span class="fl">4.28</span>,
  <span class="fl">80</span>, <span class="fl">110</span>, <span class="fl">7.80</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>IFR <span class="op">=</span> <span class="va">IFR</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lower_age</span>, <span class="st">"-"</span>, <span class="va">upper_age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">age_range</span>, <span class="va">lower_age</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_range</span>, y<span class="op">=</span><span class="va">IFR</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Age range"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"IFR"</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-2-1.png" width="576"></p>
<p>We can allow different rates of death in the model by modifying the equation for infectious and dead compartments to:</p>
<p><span class="math display">\[\begin{align}
\frac{\text{d}I_i}{\text{d}t} &amp;= \kappa E_i - (\gamma_i + \mu_i) I_i\\
\frac{\text{d}D_i}{\text{d}t} &amp;= \mu_i I_i.
\end{align}\]</span></p>
<p>where each compartment has its own death rate, <span class="math inline">\(\mu_i\)</span> and recovery rate, <span class="math inline">\(\gamma_i\)</span>. We allow different recovery rates across the age classes because of the flexibility it provides in parameterising the model – see below.</p>
<p>Since, in this model, there are only two fates for an infectious individual – death and recovery – the proportion of infectious individuals who die is given by:</p>
<p><span class="math display">\[\begin{equation}
\text{IFR}_i = \frac{\text{rate of death}}{\text{rate of death} + \text{rate of recovery}} = \frac{\mu_i}{\mu_i + \gamma_i}.
\end{equation}\]</span></p>
</div>
<div class="section level2">
<h2 id="intermixing-between-age-groups">Intermixing between age groups<a class="anchor" aria-label="anchor" href="#intermixing-between-age-groups"></a>
</h2>
<p>The aforementioned system of ODEs does not, currently, allow individuals from different age classes to mix with one another. However, in reality, a susceptible individual from a given age class can become infected from any age class: to capture this aspect of the model, infected individuals of any age are supposed to intermix, with the mixing rate dictated by a so-called “contact matrix”, <span class="math inline">\(C\)</span>.</p>
<p>The elements of contact matrices, <span class="math inline">\(C_{i,j}\)</span>, indicate the expected number of contacts an individual of age class <span class="math inline">\(i\)</span> experiences with age class <span class="math inline">\(j\)</span> per day. In this package, we include country-level estimates of contact matrices (<span class="citation">Prem, Cook, and Jit (2017)</span>; for full details see data documentation). There are actually four types of contact matrix corresponding to daily numbers of contacts at home, work, school and all other settings. Here, we visualise these for India.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># reformat matrices for plotting</span>
<span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">age_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">age_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ages</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"-"</span>, <span class="va">ages</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">format_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">contact_matrix</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span><span class="op">$</span><span class="va">age_infectee</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infector</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infectee<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">c_home</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_home</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"home"</span><span class="op">)</span>
<span class="va">c_work</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_work</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"work"</span><span class="op">)</span>
<span class="va">c_school</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_school</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"school"</span><span class="op">)</span>
<span class="va">c_other</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_other</span><span class="op">$</span><span class="va">India</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"other"</span><span class="op">)</span>
<span class="va">c_all</span> <span class="op">&lt;-</span> <span class="va">c_home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_work</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_school</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_other</span><span class="op">)</span>
<span class="co"># plot all</span>
<span class="va">c_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_infector</span>, y<span class="op">=</span><span class="va">age_infectee</span>, fill<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"age group of infector"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"age group of infectee"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">type</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-4-1.png" width="768"></p>
<p>We can see that the majority of contacts fall between younger individuals, occurring at school or “other” locations. At home, however, there is more substantial intergenerational mixing than in other settings.</p>
<p>The model we introduce here does not compartmentalise individuals according to location, so we make an overall contact matrix by summming these together.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">c_combined</span> <span class="op">&lt;-</span> <span class="va">c_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_infector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'age_infectee'. You can override using the `.groups` argument.</span>
<span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_infector</span>, y<span class="op">=</span><span class="va">age_infectee</span>, fill<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"age group of infector"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"age group of infectee"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, vjust <span class="op">=</span> <span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-5-1.png" width="768"></p>
<p>We now use this contact matrix to allow infections to pass between age groups. To do so, we amend the governing equations for the susceptible and exposed individuals within age class <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[\begin{align}
\frac{\text{d}S_i}{\text{d}t} &amp;= -\beta S_i \Sigma_{j}C_{ij} I_j\\
\frac{\text{d}E_i}{\text{d}t} &amp;= \beta S_i \Sigma_{j}C_{ij} I_j -\kappa E_i\\
\end{align}\]</span></p>
<p>Specifically, the term <span class="math inline">\(S_i \Sigma_{j}C_{ij} I_j\)</span> effectively indicates the expected number of contacts between susceptible individuals of age class <span class="math inline">\(i\)</span> with infected individuals across all classes.</p>
</div>
<div class="section level2">
<h2 id="simulating-an-epidemic-characteristic-of-the-first-covid-19-wave">Simulating an epidemic characteristic of the first COVID-19 wave<a class="anchor" aria-label="anchor" href="#simulating-an-epidemic-characteristic-of-the-first-covid-19-wave"></a>
</h2>
<p>Now we create a model that includes this age-structured mixing. Since the contact matrices have 16 age classes, we instantiate a model with this number of classes. We use country-level demographics from the UN and, for this example, initialise the model with a uniform initial infected population of 0.1% across all age groups. The remaining 99.9% of the population starts as susceptible.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load UN data (which is available in the repo)</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/population.rda"</span><span class="op">)</span>

<span class="co"># use demographic data to create normalised population fractions</span>
<span class="va">pops</span> <span class="op">=</span> <span class="va">population</span><span class="op">[</span><span class="va">population</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">'India'</span>, <span class="op">]</span><span class="op">$</span><span class="va">pop</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pops</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pops</span><span class="op">)</span>

<span class="co"># the contact matrix has an upper group of 80+, so we sum the remaining fractions beyond this point</span>
<span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span><span class="op">)</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pop_fraction</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>

<span class="co"># reshape contact matrix into 16x16 form</span>
<span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fl">16</span>
<span class="va">c_combined_wider</span> <span class="op">&lt;-</span> <span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">age_infectee</span>, names_from <span class="op">=</span> <span class="va">age_infector</span>,
              values_from<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">age_infectee</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># create model</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">comomodels</span><span class="fu">::</span><span class="fu"><a href="../reference/SEIRDAge-class.html">SEIRDAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                 contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                 age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span>

<span class="co"># set initial conditions</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.999</span>,
                                  E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  I0<span class="op">=</span><span class="va">pop_fraction</span><span class="op">*</span><span class="fl">0.001</span>,
                                  R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We next give it transmission parameters. Here, we assume an average latency period of 5.5 days (as has been estimated for COVID-19; <span class="citation">Xin et al. (2021)</span>), and an average duration of infectiousness of 2 days (which indicates that, after 10 days, &lt;1% would be infectious, which is in line with UK policy which assumes individuals cannot pass on infection after 10 days; <span class="citation">UK government (2021)</span>). For simplicity, we assume that symptom onset occurs at the time an individual becomes infectious (although evidence suggests there is presymptomatic transmission; <span class="citation">UK government (2021)</span>).</p>
<p>We assume the following parameterisation: <span class="math inline">\(\eta = 1/{\text{av. time until noninfectious}}=1/2\)</span></p>
<p><span class="math display">\[\begin{align}
\gamma_i &amp;= \eta (1-\text{IFR}_i)\\
\mu_i &amp;= \eta \text{IFR}_i.
\end{align}\]</span></p>
<p>Indeed, this parameterisation is possible because we allow an age-dependent recovery rate, <span class="math inline">\(\gamma_i\)</span>.</p>
<p>The last parameter we need to set is the transmission rate, <span class="math inline">\(\beta\)</span>, which we cover in the next section.</p>
</div>
<div class="section level2">
<h2 id="basic-reproduction-number-of-age-structured-models">Basic reproduction number of age-structured models<a class="anchor" aria-label="anchor" href="#basic-reproduction-number-of-age-structured-models"></a>
</h2>
<p>“Report 9” produced by Imperial College London <span class="citation">(Ferguson et al. 2020)</span> was widely held to have been key to the UK government deciding to institute a lockdown in March 2020. In this report, the baseline reproduction number chosen was <span class="math inline">\(R_0=2.4\)</span>. In this vignette, we wish to choose a value of <span class="math inline">\(\beta\)</span> to result in the same <span class="math inline">\(R_0\)</span> value.</p>
<p>But how do we calculate <span class="math inline">\(R_0\)</span> for an age-structured model? We can reason in similar fashion as for the basic SEIRD model. We start by considering the the expected number of secondary infections of type <span class="math inline">\(i\)</span> caused by a single infectious individual of type <span class="math inline">\(j\)</span>, assuming that all of type i are susceptible: we call this quantity <span class="math inline">\(g_{ij}\)</span>. In an entirely susceptible population, the number of new infections of type <span class="math inline">\(i\)</span> caused by a single individual of type <span class="math inline">\(j\)</span> is <span class="math inline">\(\beta N_i C_{ij}\)</span> per unit time, where <span class="math inline">\(N_i\)</span> is the fraction of the population in age group <span class="math inline">\(i\)</span>. The average duration of infection is <span class="math inline">\(1 / (\mu_j + \gamma_j)\)</span> for an individual in age group <span class="math inline">\(j\)</span>. This means the average number of secondary infections of type i caused by an infectious individual of type j is:</p>
<p><span class="math display">\[g_{ij} = \frac{\beta N_i C_{ij}}{(\mu_j + \gamma_j)}.\]</span> The next generation matrix, <span class="math inline">\(G\)</span>, is then effectively the matrix containing all the <span class="math inline">\(g_{ij}\)</span> elements <span class="citation">(Jones 2007)</span><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Technically, the matrix &lt;span class="math inline"&gt;\(G\)&lt;/span&gt; is only a subcomponent of this larger matrix, since we have not considered the exposed compartment in this derivation. But this submatrix has the same dominant eigenvalue as the overall matrix. For an interested reader, we now follow the methodology exposed in &lt;span class="citation"&gt;(Diekmann, Heesterbeek, and Roberts 2010)&lt;/span&gt; to derive the next generation matrix for an age-structured model with two age groups. We consider only the infected compartments, &lt;span class="math inline"&gt;\(E\)&lt;/span&gt; and &lt;span class="math inline"&gt;\(I\)&lt;/span&gt;, meaning we have four categories in total: &lt;span class="math inline"&gt;\(E_1\)&lt;/span&gt;, &lt;span class="math inline"&gt;\(E_2\)&lt;/span&gt;, &lt;span class="math inline"&gt;\(I_1\)&lt;/span&gt; and &lt;span class="math inline"&gt;\(I_2\)&lt;/span&gt; where the subscript indicates age grouping. We define a matrix &lt;span class="math inline"&gt;\(T\)&lt;/span&gt; whose elements &lt;span class="math inline"&gt;\(T_{ij}\)&lt;/span&gt; indicate the number of new infections produced per unit time into category &lt;span class="math inline"&gt;\(i\)&lt;/span&gt; given a single individual in category &lt;span class="math inline"&gt;\(j\)&lt;/span&gt;. This matrix is then: &lt;span class="math display"&gt;\[
T = \left(\begin{array}{cc} 
0 &amp;amp; 0 &amp;amp; \beta N_1 C_{11} &amp;amp; \beta N_1 C_{12}\\
0 &amp;amp; 0 &amp;amp; \beta N_2 C_{21} &amp;amp; \beta N_2 C_{22}\\
0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0\\
0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0
\end{array}\right),
\]&lt;/span&gt; where, for instance, &lt;span class="math inline"&gt;\(\beta N_1 C_{11}\)&lt;/span&gt; is the rate new infections are generated in the &lt;span class="math inline"&gt;\(E_1\)&lt;/span&gt; compartment (the row) due to a single individual in the &lt;span class="math inline"&gt;\(I_1\)&lt;/span&gt; compartment (the column). The bottom two rows are all zero because, in this system, no new infections are generated that immediately fall into the &lt;span class="math inline"&gt;\(I_i\)&lt;/span&gt; compartments. The first two columns are zero because the &lt;span class="math inline"&gt;\(E_i\)&lt;/span&gt; compartments do not themselves generated infections. Next, we construct the matrix &lt;span class="math inline"&gt;\(\Sigma\)&lt;/span&gt; whose elements, &lt;span class="math inline"&gt;\(\Sigma_{ij}\)&lt;/span&gt; indicate the rate of transition from compartment &lt;span class="math inline"&gt;\(j\)&lt;/span&gt; to &lt;span class="math inline"&gt;\(i\)&lt;/span&gt;: &lt;span class="math display"&gt;\[
\Sigma = \left(\begin{array}{cc} 
-\kappa &amp;amp; 0 &amp;amp; 0 &amp;amp; 0\\
0 &amp;amp; -\kappa &amp;amp; 0 &amp;amp; 0\\
\kappa &amp;amp; 0 &amp;amp; -(\mu_1+\gamma_1) &amp;amp; 0\\
0 &amp;amp; \kappa &amp;amp; 0 &amp;amp; -(\mu_2+\gamma_2)
\end{array}\right),
\]&lt;/span&gt; where, for instance, &lt;span class="math inline"&gt;\(\kappa\)&lt;/span&gt; indicates the rate at which either &lt;span class="math inline"&gt;\(E_1\rightarrow I_1\)&lt;/span&gt; or &lt;span class="math inline"&gt;\(E_2\rightarrow I_2\)&lt;/span&gt;. The next generation matrix is then given by the product &lt;span class="math inline"&gt;\(-T\Sigma^{-1}\)&lt;/span&gt;, which in this case evaluates to: &lt;span class="math display"&gt;\[
K = \left(\begin{array}{cc} 
 \beta C_{11}N_1 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{12}N_1 /(\mu_2+\gamma_2) &amp;amp; \beta C_{11}N_1 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{12}N_1 /(\mu_2+\gamma_2)\\
\beta C_{21}N_2 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{22}N_2 /(\mu_2+\gamma_2) &amp;amp; \beta C_{21}N_2 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{22}N_2 /(\mu_2+\gamma_2)\\
0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0\\
0 &amp;amp; 0 &amp;amp; 0 &amp;amp; 0
\end{array}\right),
\]&lt;/span&gt; whose dominant eigenvalue is the same as that of the submatrix: &lt;span class="math display"&gt;\[
G = \left(\begin{array}{cc} 
 \beta C_{11}N_1 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{12}N_1 /(\mu_2+\gamma_2)\\
\beta C_{21}N_2 /(\mu_1+\gamma_1)  &amp;amp; \beta C_{22}N_2 /(\mu_2+\gamma_2)
\end{array}\right),
\]&lt;/span&gt; which is that considered in the main text.&lt;/p&gt;'><sup>1</sup></a>. The individual elements of it dictate whether, from a disease-free equilibrium, there will be growth in the number of infections of type <span class="math inline">\(i\)</span>, if <span class="math inline">\(g_{ij}&gt;1\)</span>. But, how do we know whether, on aggregate, there will be a growth in infections? To obtain this, we take the dominant eigenvalue of the matrix <span class="math inline">\(G\)</span> (<span class="citation">Jones (2007)</span>).</p>
<p>This approach to finding (and, actually, defining <span class="math inline">\(R_0\)</span>) comes from <span class="citation">Diekmann, Heesterbeek, and Metz (1990)</span>, who proposed it as providing a measure of stability from the disease-free equilibrium in a linearised version of the system.</p>
<p>In <code>comomodels</code>, we have implemented these calculations, and so can calculate <span class="math inline">\(R_0\)</span> for an age-structured model. As such, we have selected a value for <span class="math inline">\(\beta\)</span> below that reproduces <span class="math inline">\(R_0=2.4\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">5.5</span>
<span class="va">eta</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">0.707</span>

<span class="co"># assume IFR constant within age ranges of contact matrix bands</span>
<span class="va">get_lower_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">regexpr</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">get_upper_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">regexpr</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">lower_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">age_names</span>, <span class="va">get_lower_age</span><span class="op">)</span>
<span class="va">upper_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">age_names</span>, <span class="va">get_upper_age</span><span class="op">)</span>
<span class="va">middle_age</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lower_age</span> <span class="op">+</span> <span class="va">upper_age</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>

<span class="co"># assume IFR is constant within age bands</span>
<span class="va">IFR_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">middle_age</span><span class="op">)</span><span class="op">)</span>
<span class="va">IFR_getter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="va">df</span><span class="op">$</span><span class="va">lower_age</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">df</span><span class="op">$</span><span class="va">upper_age</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">IFR</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">IFR_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">middle_age</span>, <span class="op">~</span><span class="fu">IFR_getter</span><span class="op">(</span><span class="va">.</span>, <span class="va">df</span><span class="op">)</span><span class="op">)</span>
<span class="va">gamma_vals</span> <span class="op">&lt;-</span> <span class="va">eta</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">IFR_vals</span><span class="op">)</span>
<span class="va">mu_vals</span> <span class="op">&lt;-</span> <span class="va">eta</span> <span class="op">*</span> <span class="va">IFR_vals</span>

<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">beta</span>, k<span class="op">=</span><span class="va">kappa</span>, g<span class="op">=</span><span class="va">gamma_vals</span>, mu<span class="op">=</span><span class="va">mu_vals</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"R_0 = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/R0.html">R0</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">pop_fraction</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "R_0 = 2.4"</span></code></pre></div>
<p>We next simulate the model and visualise the dynamics of each compartment.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
<span class="va">states</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">states</span>
<span class="va">changes</span> <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">changes</span>
<span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
<p>Zooming in on the infected population, we see that the younger age groups have the highest peak infected population levels.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-9-1.png" width="768"></p>
<p>Which is reflected in the incidences.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Incidence"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>But, due to the much higher rate of death in the older age groups, these experience a much higher rate of death.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"time (days)"</span>, y <span class="op">=</span> <span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
</div>
<div class="section level2">
<h2 id="sensitivity-to-initial-conditions">Sensitivity to initial conditions<a class="anchor" aria-label="anchor" href="#sensitivity-to-initial-conditions"></a>
</h2>
<p>We now simulate the same model but with different distributions of initial infections to show the sensitivity of the model to initial conditions. First, we set all initial infections to 0.3% of the total population and place this uniformly across age groups between 15 and 30. Second, we place all infections (also 0.3% of the total population) uniformly across age groups 55-70.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_1530</span> <span class="op">&lt;-</span> <span class="fu">comomodels</span><span class="fu">::</span><span class="fu"><a href="../reference/SEIRDAge-class.html">SEIRDAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                 contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                 age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span>
<span class="va">model_5570</span> <span class="op">&lt;-</span> <span class="fu">comomodels</span><span class="fu">::</span><span class="fu"><a href="../reference/SEIRDAge-class.html">SEIRDAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                 contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                 age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model_1530</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">beta</span>, k<span class="op">=</span><span class="va">kappa</span>, g<span class="op">=</span><span class="va">gamma_vals</span>, mu<span class="op">=</span><span class="va">mu_vals</span><span class="op">)</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model_5570</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>b<span class="op">=</span><span class="va">beta</span>, k<span class="op">=</span><span class="va">kappa</span>, g<span class="op">=</span><span class="va">gamma_vals</span>, mu<span class="op">=</span><span class="va">mu_vals</span><span class="op">)</span>
<span class="va">S0_1530</span> <span class="op">=</span> <span class="va">pop_fraction</span>
<span class="va">S0_1530</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="va">S0_1530</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.001</span>
<span class="va">I0_1530</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>
<span class="va">I0_1530</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0.001</span>
<span class="va">S0_5570</span> <span class="op">=</span> <span class="va">pop_fraction</span>
<span class="va">S0_5570</span><span class="op">[</span><span class="fl">12</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span> <span class="op">=</span> <span class="va">S0_5570</span><span class="op">[</span><span class="fl">12</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span> <span class="op">-</span> <span class="fl">0.001</span>
<span class="va">I0_5570</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>
<span class="va">I0_5570</span><span class="op">[</span><span class="fl">12</span><span class="op">:</span><span class="fl">14</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0.001</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model_1530</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">S0_1530</span>,
                                  E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  I0<span class="op">=</span><span class="va">I0_1530</span>,
                                  R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model_5570</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">S0_5570</span>,
                                  E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  I0<span class="op">=</span><span class="va">I0_5570</span>,
                                  R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
                                  D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we simulate both models and plot the infections over time. For the model initialised with infections among 15-30 years olds, the peak of infections appears earlier and dies away quicker than the model initialised with infections in 55-70 year olds. Despite this difference, the magnitude of the infection peaks in both cases are comparable as well as the distribution of infections for each age group.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model_1530</span>, time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">70</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">states</span>
<span class="va">res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"time (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model_5570</span>, time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">70</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">states</span>
<span class="va">res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span>, colour<span class="op">=</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"time (days)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"fraction of the population"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRD_age_structured_files/figure-html/unnamed-chunk-13-2.png" width="768"></p>
<p>This example shows that the nature of the seeding population (i.e. the population initially infected) can significantly influence the resultant dynamics. Here, because the younger age groups have more daily contact with other individuals, an epidemic seeded with them goes through the population faster than one seeded more uniformly across older ages.</p>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-diekmann1990definition">
<p>Diekmann, Odo, JAP Heesterbeek, and Johan AJ Metz. 1990. “On the Definition and the Computation of the Basic Reproduction Ratio R0 in Models for Infectious Diseases in Heterogeneous Populations.” <em>Journal of Mathematical Biology</em> 28 (4): 365–82.</p>
</div>
<div id="ref-diekmann2010construction">
<p>Diekmann, Odo, JAP Heesterbeek, and Michael G Roberts. 2010. “The Construction of Next-Generation Matrices for Compartmental Epidemic Models.” <em>Journal of the Royal Society Interface</em> 7 (47): 873–85.</p>
</div>
<div id="ref-ferguson2020report">
<p>Ferguson, Neil, Daniel Laydon, Gemma Nedjati Gilani, Natsuko Imai, Kylie Ainslie, Marc Baguelin, Sangeeta Bhatia, et al. 2020. “Report 9: Impact of Non-Pharmaceutical Interventions (Npis) to Reduce Covid19 Mortality and Healthcare Demand.”</p>
</div>
<div id="ref-jones2007notes">
<p>Jones, James Holland. 2007. “Notes on R0.” <em>California: Department of Anthropological Sciences</em> 323: 1–19.</p>
</div>
<div id="ref-prem2017projecting">
<p>Prem, Kiesha, Alex R Cook, and Mark Jit. 2017. “Projecting Social Contact Matrices in 152 Countries Using Contact Surveys and Demographic Data.” <em>PLoS Computational Biology</em> 13 (9): e1005697.</p>
</div>
<div id="ref-stayathome2021">
<p>UK government. 2021. “Stay at home: guidance for households with possible or confirmed coronavirus (COVID-19) infection. Updated 2 December 2021.” <a href="https://www.gov.uk/government/publications/covid-19-stay-at-home-guidance/stay-at-home-guidance-for-households-with-possible-coronavirus-covid-19-infection" class="external-link">https://www.gov.uk/government/publications/covid-19-stay-at-home-guidance/stay-at-home-guidance-for-households-with-possible-coronavirus-covid-19-infection</a>.</p>
</div>
<div id="ref-verity2020estimates">
<p>Verity, Robert, Lucy C Okell, Ilaria Dorigatti, Peter Winskill, Charles Whittaker, Natsuko Imai, Gina Cuomo-Dannenburg, et al. 2020. “Estimates of the Severity of Coronavirus Disease 2019: A Model-Based Analysis.” <em>The Lancet Infectious Diseases</em> 20 (6): 669–77.</p>
</div>
<div id="ref-xin2021estimating">
<p>Xin, Hualei, Yu Li, Peng Wu, Zhili Li, Eric HY Lau, Ying Qin, Liping Wang, Benjamin J Cowling, Tim Tsang, and Zhongjie Li. 2021. “Estimating the Latent Period of Coronavirus Disease 2019 (Covid-19).” <em>Clinical Infectious Diseases: An Official Publication of the Infectious Diseases Society of America</em>.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The Como-DTC Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
