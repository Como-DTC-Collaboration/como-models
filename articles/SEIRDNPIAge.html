<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="comomodels">
<title>NPIs: age-structured model • comomodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="NPIs: age-structured model">
<meta property="og:description" content="comomodels">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">comomodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/SEIRD_age_structured.html">Age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIaImIsRD.html">Asymptomatic, mild and severe symptom compartment model</a>
    <a class="dropdown-item" href="../articles/SEIRD_BD.html">Births and natural deaths and waning natural immunity</a>
    <a class="dropdown-item" href="../articles/SEIRDNPIAge.html">NPIs: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD.html">SEIRD model</a>
    <a class="dropdown-item" href="../articles/SEIRDV.html">Vaccinations model</a>
    <a class="dropdown-item" href="../articles/SEIRDVAge.html">Vaccinations: age-structured model</a>
    <a class="dropdown-item" href="../articles/SEIRD_rural_urban.html">Urban and rural metapopulations model</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="SEIRDNPIAge_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>NPIs: age-structured model</h1>
                        <h4 data-toc-skip class="author">Oscar Dimdore-Miles, Idil Cazimoglu and Liangti Dai</h4>
            
            <h4 data-toc-skip class="date">28/10/2021</h4>
      
      
      <div class="d-none name"><code>SEIRDNPIAge.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Before effective vaccines existed, the only public health interventions available to governments around the world were non-pharmaceutical interventions (NPIs). The types of NPIs deployed have included, amongst other interventions: early detection and isolation of cases; mask-wearing and hand hygiene measures; physical distancing, where members of the public are encouraged to isolate from one another; shielding vulnerable groups, for example, by requiring elderly individuals to not mix with the public; school closures; and country- or region-wide lockdowns, where members of the public are required to remain in their homes with (typically) stringent restrictions on the nature of and degree to which they socialise.</p>
<p>A variety of NPIs have been estimated as having substantially lowered COVID-19 transmission and reduced burdens on health systems across a range of countries <span class="citation">(Flaxman et al. 2020; Li et al. 2021; Lai et al. 2020; Davies et al. 2020)</span>. As such, these interventions were likely crucial in averting many COVID-19-related deaths.</p>
<p>In this vignette, we introduce <strong>an age-structured model including NPI strategies (SEIRDNPIAge)</strong> and demonstrate the effect of a number of different NPI strategies to examine the effects of interventions. Since a number of the aforementioned NPIs have varying effects on different age groups, we chose to account for them by extending the <a href="https://github.com/Como-DTC-Collaboration/como-models/blob/main/vignettes/SEIRD_age_structured.Rmd" class="external-link">SEIRDAge model</a>.</p>
<p>Before we start, we define some helper functions for plotting and contact matrix processing which avoid repeated code.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">comomodels</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2</span> 3.3.5     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble </span> 3.1.6     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr  </span> 1.0.7</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr  </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr  </span> 2.1.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span>

<span class="co"># color by age groups</span>
<span class="va">ggplot_results_by_compartment</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">output</span>, <span class="va">x</span><span class="op">=</span><span class="st">"time"</span>, <span class="va">y</span><span class="op">=</span><span class="st">"value"</span>, <span class="va">colour</span><span class="op">=</span><span class="st">"age_range"</span>, 
                                          <span class="va">labs_x</span> <span class="op">=</span> <span class="st">"time (days)"</span>, <span class="va">labs_y</span> <span class="op">=</span> <span class="st">"fraction of the population"</span>, <span class="va">text_size</span><span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">{</span>
  <span class="va">output</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html" class="external-link">aes_string</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>, y<span class="op">=</span><span class="va">y</span>, colour<span class="op">=</span><span class="va">colour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_d</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">labs_x</span>, y <span class="op">=</span> <span class="va">labs_y</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">text_size</span><span class="op">)</span><span class="op">)</span>  
<span class="op">}</span>

<span class="va">format_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">contact_matrix</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span><span class="op">$</span><span class="va">age_infectee</span> <span class="op">&lt;-</span> <span class="va">age_names</span>
  <span class="va">contact_matrix</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="va">name</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infector<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infector</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_infectee<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_relevel.html" class="external-link">fct_relevel</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_names</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">combine_contact_matrices</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">c_all</span><span class="op">)</span><span class="op">{</span>
  <span class="va">c_all</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_infectee</span>, <span class="va">age_infector</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">combined_contact_matrices_wider</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">c_combined</span><span class="op">)</span><span class="op">{</span>
  <span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">age_infectee</span>, names_from <span class="op">=</span> <span class="va">age_infector</span>,
              values_from<span class="op">=</span><span class="va">value</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">age_infectee</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-seirdnpiage-model">The SEIRDNPIAge Model<a class="anchor" aria-label="anchor" href="#the-seirdnpiage-model"></a>
</h2>
<p>The <code>SEIRDNPIAge</code> model consists of five ODEs describing five populations of susceptible, recovered, infectious, recovered and dead individuals. Susceptible individuals (<span class="math inline">\(S\)</span>) have not been exposed to the virus. Exposed individuals (<span class="math inline">\(E\)</span>) have been exposed to the virus and have been infected but are not yet infectious to others; they are in the incubation period. Infectious individuals (<span class="math inline">\(I\)</span>) can spread the virus to others. Recovered individuals (<span class="math inline">\(R\)</span>) are no longer infectious and are protected from reinfection. Here, we assume that there is no waning natural immunity, so once individuals are recovered from infection they never become susceptible again. Births and natural deaths (i.e. those unrelated to COVID-19 infection) are not considered in this model. Those infected individuals who have died due to infection form the “dead” (<span class="math inline">\(D\)</span>) compartment.</p>
<p>The ODEs describing how the five populations evolve over time are:</p>
<p><span class="math display">\[\frac{\text{d}S_i}{\text{d}t} = -\beta(t) S_i \Sigma_{j}C_{ij}(t) I_j,\]</span> <span class="math display">\[\frac{\text{d}E_i}{\text{d}t} = \beta(t) S_i \Sigma_{j}C_{ij}(t) I_j-\kappa E_i,\]</span> <span class="math display">\[\frac{\text{d}I_i}{\text{d}t} = \kappa E_i - (\gamma_i + \mu_i) I_i,\]</span> <span class="math display">\[\frac{\text{d}R_i}{\text{d}t} = \gamma_i I_i,\]</span> <span class="math display">\[\frac{\text{d}D_i}{\text{d}t} = \mu_i I_i,\]</span></p>
<p>where <span class="math inline">\(i\)</span> represents a particular age class, and <span class="math inline">\(t\)</span> represents a time point. <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\gamma_i\)</span>, <span class="math inline">\(\mu_i\)</span>, <span class="math inline">\(\nu\)</span> are positive parameters as described in the <a href="https://github.com/Como-DTC-Collaboration/como-models/blob/main/vignettes/SEIRD_age_structured.Rmd" class="external-link">SEIRDAge model vignette</a>.</p>
<p>The key parameters of the <code>SEIRDNPIAge</code> model are: <span class="math inline">\(\beta(t)\)</span> and <span class="math inline">\(C_{ij}(t)\)</span> representing time-dependent rates of infection and contact matrix elements, respectively. This model allows for discontinuous changes in either the rate parameter and / or the contact matrix over time in one or a number of intervention blocks.</p>
<p>What might those changes in these parameters represent? A change in <span class="math inline">\(\beta\)</span> represents a change in the probability that a transmission occurs upon an infectious and susceptible individual meeting. If <span class="math inline">\(\beta\)</span> declined, this could represent, for instance, a government imposition of a rule that requires individuals to wear masks when in public spaces. A change in the contact matrix could represent a number of NPIs: in the event of a lockdown, the number of daily contacts outside the home would likely decline; if a decision was taken to shield the elderly, this would result in a decline in the relevant elements of the contact matrix pertaining to this group.</p>
<p>The system is closed by specifying the initial conditions <span class="math display">\[S(0) = S_0,\ E(0) = E_0,\ I(0) = I_0,\ R(0) = R_0, \ D(0) = 0.\]</span> In the implementation of the model in this package, the variables are normalized so <span class="math inline">\(S(t) + E(t) + I(t) + R(t) + D(t) \equiv 1\)</span> for any given <span class="math inline">\(t\)</span>. This means that each of these state variables represents the fraction of the population in each of these states at a given point in time.</p>
<p>The calculation of the basic reproduction number follows the same next-generation matrix approach as in the <a href="https://github.com/Como-DTC-Collaboration/como-models/blob/main/vignettes/SEIRD_age_structured.Rmd" class="external-link">SEIRDAge model</a>, and uses the non-intervention parameters to calculate it.</p>
</div>
<div class="section level2">
<h2 id="mimicking-the-1st-uk-lockdown">Mimicking the 1st UK lockdown<a class="anchor" aria-label="anchor" href="#mimicking-the-1st-uk-lockdown"></a>
</h2>
<p>On the 23rd March 2022, the Prime Minister of the UK announced the first lockdown in the country, ordering people to “stay at home” <span class="citation">(IFG 2021)</span>. The lockdown then came legally into force on the 26th March. In June, there was a phased reopening of schools, non-essential shops reopened and a further relaxing of restrictions including a “2m distancing rule”. During early July, more restrictions were eased leading to the reopening of pubs, restaurants and hairdressers. Whilst the restrictions were not fully eased until the following year, we assume that the first lockdown lasted from 26th March until early July: a period of roughly 14 weeks.</p>
<p>During lockdown, we assume that overall contacts declined by a factor of 2, which is similar to the ranges considered in Imperial College’s Report 9 <span class="citation">(Ferguson et al. 2020)</span>.</p>
<p>We first load the relevant contact matrices, country-level demographics from the UN for the UK.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get contact matrices for the UK</span>
<span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, <span class="fl">5</span><span class="op">)</span>
<span class="va">age_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">age_names</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">ages</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"-"</span>, <span class="va">ages</span><span class="op">[</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">c_home</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_home</span><span class="op">$</span><span class="va">`United Kingdom of Great Britain`</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"home"</span><span class="op">)</span>
<span class="va">c_work</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_work</span><span class="op">$</span><span class="va">`United Kingdom of Great Britain`</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"work"</span><span class="op">)</span>
<span class="va">c_school</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_school</span><span class="op">$</span><span class="va">`United Kingdom of Great Britain`</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"school"</span><span class="op">)</span>
<span class="va">c_other</span> <span class="op">&lt;-</span> <span class="fu">format_matrix</span><span class="op">(</span><span class="va">contact_other</span><span class="op">$</span><span class="va">`United Kingdom of Great Britain`</span>, <span class="va">age_names</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"other"</span><span class="op">)</span>

<span class="va">c_all</span> <span class="op">&lt;-</span> <span class="va">c_home</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_work</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_school</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">c_other</span><span class="op">)</span>

<span class="va">c_combined</span> <span class="op">&lt;-</span> <span class="fu">combine_contact_matrices</span><span class="op">(</span><span class="va">c_all</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'age_infectee'. You can override using the `.groups` argument.</span>

<span class="co"># use demographic data to create normalised population fractions</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"../data/population.rda"</span><span class="op">)</span>
<span class="va">pops</span> <span class="op">=</span> <span class="va">population</span><span class="op">[</span><span class="va">population</span><span class="op">$</span><span class="va">country</span> <span class="op">==</span> <span class="st">'United Kingdom'</span>, <span class="op">]</span><span class="op">$</span><span class="va">pop</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pops</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pops</span><span class="op">)</span>

<span class="co"># the contact matrix has an upper group of 80+, so we sum the remaining fractions beyond this point</span>
<span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pop_fraction</span><span class="op">[</span><span class="fl">16</span><span class="op">:</span><span class="fl">21</span><span class="op">]</span><span class="op">)</span>
<span class="va">pop_fraction</span> <span class="op">=</span> <span class="va">pop_fraction</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>

<span class="co"># reshape contact matrix into 16x16 form</span>
<span class="va">c_combined_wider</span> <span class="op">&lt;-</span> <span class="fu">combined_contact_matrices_wider</span><span class="op">(</span><span class="va">c_combined</span><span class="op">)</span>
<span class="co"># setting up the number of age classes</span>
<span class="va">n_ages</span> <span class="op">&lt;-</span> <span class="fl">16</span></code></pre></div>
<p>We next create a model with the appropriate contact matrices: <code>contact_matrix</code> is a single matrix that represents the original contact matrix when no intervention is applied, whereas <code>contact_matrix_npi</code> defines a list of matrices corresponding to the contact matrices of each intervention period. <code>n_npi</code> represents the the number of non-overlapping NPI intervention periods: here, this is 1.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create model</span>
<span class="va">n_npi</span> <span class="op">=</span> <span class="fl">1</span> <span class="co"># only one intervention</span>
<span class="va">lockdown_reduced_contacts_factor</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDNPIAge-class.html">SEIRDNPIAge</a></span><span class="op">(</span>n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
                      n_npi <span class="op">=</span> <span class="va">n_npi</span>,
                      contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
                      contact_matrix_npi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">c_combined_wider</span> <span class="op">/</span> <span class="va">lockdown_reduced_contacts_factor</span><span class="op">)</span>,
                      age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>
                      <span class="op">)</span></code></pre></div>
<p>We now need to set the initial conditions for the model. Here, we assume a uniform initial infected population of 0.1% across all age groups. The remaining 99.9% of the population starts as susceptibles.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">inits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>S0<span class="op">=</span><span class="va">pop_fraction</span> <span class="op">*</span> <span class="fl">0.999</span>,
              E0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
              I0<span class="op">=</span><span class="va">pop_fraction</span> <span class="op">*</span> <span class="fl">0.001</span>,
              R0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span>,
              D0<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_ages</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">inits</span></code></pre></div>
<p>Next, we need to set the transmission parameter values <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\mu\)</span>.</p>
<p>To set age-dependent values for <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\mu\)</span>, we adopted the age-dependent Infection Fatality Ratio (IFR, the fraction of infected individuals who go on to die) according to <span class="citation">(Verity et al. 2020)</span>, as IFR is only dependent on <span class="math inline">\(\gamma\)</span> and <span class="math inline">\(\mu\)</span>:</p>
<p><span class="math display">\[ \text{IFR}_i = \frac{\text{rate of death of age class }i}{\text{rate of death of age class }i + \text{rate of recovery of age class }i} = \frac{\mu_i}{\mu_i + \gamma_i} \]</span></p>
<p>We assume an average latency period (<span class="math inline">\(1/\kappa\)</span>) of 5.5 days (as has been estimated for COVID-19; <span class="citation">Xin et al. (2021)</span>) and an average duration of infectiousness (<span class="math inline">\(1/\eta\)</span>) of 2 days (which indicates that, after 10 days, <span class="math inline">\(&lt;1\%\)</span> would be infectious, which is in line with UK policy which assumes individuals cannot pass on infection after 10 days; <span class="citation">UK government (2021)</span>). For simplicity, we assume that symptom onset occurs at the time an individual becomes infectious (although evidence suggests there is presymptomatic transmission; <span class="citation">UK government (2021)</span>).</p>
<p>We assume the following parameterisation:</p>
<p><span class="math display">\[
\eta = 1/{\text{av. time until noninfectious}}=1/2 \\
\gamma_i = \eta (1-\text{IFR}_i) \\
\mu_i = \eta \text{IFR}_i.
\]</span></p>
<p>At this point, <span class="math inline">\(\kappa\)</span> is defined; <span class="math inline">\(\gamma_i\)</span> and <span class="math inline">\(\mu_i\)</span> can be derived; and <span class="math inline">\(\beta(t)\)</span> needs to be set. In the setter function <code>transmission_parameters</code> for <code>SEIRDNPIAge</code>, the parameter <code>beta</code> defines the transmission rate for each age group when no intervention is applied; whereas <code>beta_npi</code> defines a list of age-dependent transmission rates that corresponds to each intervention period, or a single vector or a value if there’s only a single intervention period. Consistent with the examples presented in <code>SEIRDAge</code> class, here we choose a value for <span class="math inline">\(\beta\)</span> to be the same across all age groups to result in the same <span class="math inline">\(R_0\)</span> value (<span class="math inline">\(R_0=2.4\)</span>) as reported in “Report 9” by Imperial College London <span class="citation">(Ferguson et al. 2020)</span>, and we set <code>beta_npi</code> to be <span class="math inline">\(\beta\)</span>: i.e. it is assumed that there is no change in the probability of infection if an infectious and susceptible individual do meet – note, this would be violated if, during the lockdown, people were more likely to wear masks.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># IFR for each age group</span>
<span class="co"># (for 80+ group we pick upper age to be 110)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">lower_age</span>, <span class="op">~</span><span class="va">upper_age</span>, <span class="op">~</span><span class="va">IFR</span>,
  <span class="fl">0</span>, <span class="fl">9</span>, <span class="fl">0.00161</span>,
  <span class="fl">10</span>, <span class="fl">19</span>, <span class="fl">0.00695</span>,
  <span class="fl">20</span>, <span class="fl">29</span>, <span class="fl">0.0309</span>,
  <span class="fl">30</span>, <span class="fl">39</span>, <span class="fl">0.0844</span>,
  <span class="fl">40</span>, <span class="fl">49</span>, <span class="fl">0.161</span>,
  <span class="fl">50</span>, <span class="fl">59</span>, <span class="fl">0.595</span>,
  <span class="fl">60</span>, <span class="fl">69</span>, <span class="fl">1.93</span>,
  <span class="fl">70</span>, <span class="fl">79</span>, <span class="fl">4.28</span>,
  <span class="fl">80</span>, <span class="fl">110</span>, <span class="fl">7.80</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>IFR <span class="op">=</span> <span class="va">IFR</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">lower_age</span>, <span class="st">"-"</span>, <span class="va">upper_age</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">age_range</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>age_range<span class="op">=</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_reorder.html" class="external-link">fct_reorder</a></span><span class="op">(</span><span class="va">age_range</span>, <span class="va">lower_age</span><span class="op">)</span><span class="op">)</span>

<span class="co"># setting up kappa, eta, beta</span>
<span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">5.5</span>
<span class="va">eta</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">2</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1.69</span>

<span class="co"># assume IFR constant within age ranges of contact matrix bands</span>
<span class="va">get_lower_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">regexpr</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">get_upper_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">regexpr</a></span><span class="op">(</span><span class="st">"-"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">lower_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">age_names</span>, <span class="va">get_lower_age</span><span class="op">)</span>
<span class="va">upper_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">age_names</span>, <span class="va">get_upper_age</span><span class="op">)</span>
<span class="va">middle_age</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lower_age</span> <span class="op">+</span> <span class="va">upper_age</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>

<span class="co"># assume IFR is constant within age hands</span>
<span class="va">IFR_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">middle_age</span><span class="op">)</span><span class="op">)</span>
<span class="va">IFR_getter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">age</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="va">df</span><span class="op">$</span><span class="va">lower_age</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">df</span><span class="op">$</span><span class="va">upper_age</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">IFR</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="va">IFR_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="va">middle_age</span>, <span class="op">~</span><span class="fu">IFR_getter</span><span class="op">(</span><span class="va">.</span>, <span class="va">df</span><span class="op">)</span><span class="op">)</span>

<span class="co"># defive age-dependent gamma and mu</span>
<span class="va">gamma_vals</span> <span class="op">&lt;-</span> <span class="va">eta</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">IFR_vals</span><span class="op">)</span>
<span class="va">mu_vals</span> <span class="op">&lt;-</span> <span class="va">eta</span> <span class="op">*</span> <span class="va">IFR_vals</span>

<span class="co"># setting up transmission parameters</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta_npi <span class="op">=</span> <span class="va">beta</span>, beta <span class="op">=</span> <span class="va">beta</span>,
               kappa <span class="op">=</span> <span class="va">kappa</span>, gamma <span class="op">=</span> <span class="va">gamma_vals</span>, mu <span class="op">=</span> <span class="va">mu_vals</span><span class="op">)</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params</span></code></pre></div>
<p>We can check if the basic reproduction number is as we expected:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"R_0 = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="../reference/R0.html">R0</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "R_0 = 2.4"</span></code></pre></div>
<p>Now we simulate the system assuming a single intervention between <span class="math inline">\(t=20\)</span> and <span class="math inline">\(t=98\)</span> days.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create inteverntion</span>
<span class="va">intervention</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"starts"</span><span class="op">=</span><span class="fl">20</span>, <span class="st">"stops"</span><span class="op">=</span><span class="fl">98</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/interventions.html">interventions</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">intervention</span>

<span class="co"># simulate for a year</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">365</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">out_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span><span class="op">)</span></code></pre></div>
<p>Let us plot the population size for each epidemiological group and each age group.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states</span> <span class="op">=</span> <span class="va">out_df</span><span class="op">$</span><span class="va">states</span>
<span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">ggplot_results_by_compartment</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/unnamed-chunk-9-1.png" width="960"></p>
<p>It is hard to make out clear patterns when we examine all the compartments, so, in the next plot, we zoom in on the infectious population.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"I"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">ggplot_results_by_compartment</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">compartment</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/unnamed-chunk-10-1.png" width="768"></p>
<p>From this, the older age groups have the lowest peak infectious levels. This makes intuitive sense, since this age group have generally the lowest number of daily contacts. This is evident if we plot the overall number of daily contacts by age group, which peaks in the 15-20 age group.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">c_combined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">age_infectee</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">age_infectee</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Age group"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Average number of daily contacts"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>The number of cases mirrors the same patterns. From this plot, the impact of the lockdown period on cases is evident, causing a discontinuous change in cases at <span class="math inline">\(t=20\)</span> days. When the lockdown is lifted, the epidemic quickly resumes.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">changes</span> <span class="op">&lt;-</span> <span class="va">out_df</span><span class="op">$</span><span class="va">changes</span>
<span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Incidence"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">ggplot_results_by_compartment</span><span class="op">(</span>labs_y <span class="op">=</span> <span class="st">"case fraction"</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/fig2-1.png" width="672"></p>
<p>If we focus on deaths, the picture is quite different. Deaths have the highest peak in the oldest age groups because the IFR for these groups is disproportionately high.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Deaths"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu">ggplot_results_by_compartment</span><span class="op">(</span>labs_y <span class="op">=</span> <span class="st">"deaths fraction"</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<div class="section level3">
<h3 id="comparison-with-the-no-lockdown-scenario">Comparison with the no lockdown scenario<a class="anchor" aria-label="anchor" href="#comparison-with-the-no-lockdown-scenario"></a>
</h3>
<p>To evaluate the effectiveness of the lockdown intervention, we can compare this with a “baseline” scenario where we do nothing. Note, this baseline may be fairly unlikely because, even if a government chose not to implement a lockdown, the populace would likely change their behaviour in response to rising cases. For this baseline, we simulate from the <code>SEIRDAge</code> model using the same non-intervention parameters.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># parameterise model</span>
<span class="va">model_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SEIRDAge-class.html">SEIRDAge</a></span><span class="op">(</span>
  n_age_categories <span class="op">=</span> <span class="va">n_ages</span>,
  contact_matrix <span class="op">=</span> <span class="va">c_combined_wider</span>,
  age_ranges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">age_names</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>beta <span class="op">=</span> <span class="va">beta</span>,
               kappa <span class="op">=</span> <span class="va">kappa</span>,
               gamma <span class="op">=</span> <span class="va">gamma_vals</span>,
               mu <span class="op">=</span> <span class="va">mu_vals</span><span class="op">)</span>
<span class="fu"><a href="../reference/transmission_parameters.html">transmission_parameters</a></span><span class="op">(</span><span class="va">model_baseline</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">params</span>
<span class="fu"><a href="../reference/initial_conditions.html">initial_conditions</a></span><span class="op">(</span><span class="va">model_baseline</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">inits</span>

<span class="co"># run simulation</span>
<span class="va">out_baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span><span class="va">model_baseline</span>, <span class="va">times</span><span class="op">)</span></code></pre></div>
<p>With these simulations run, we can compare the daily cases across the lockdown and baseline scenarios.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># combine dataframes</span>
<span class="va">changes_baseline</span> <span class="op">&lt;-</span> <span class="va">out_baseline</span><span class="op">$</span><span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario<span class="op">=</span><span class="st">"baseline"</span><span class="op">)</span>
<span class="va">changes_lockdown</span> <span class="op">&lt;-</span> <span class="va">changes</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>scenario<span class="op">=</span><span class="st">"lockdown"</span><span class="op">)</span>
<span class="va">changes_both</span> <span class="op">&lt;-</span> <span class="va">changes_baseline</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">changes_lockdown</span><span class="op">)</span>

<span class="co"># plot</span>
<span class="va">changes_both</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">compartment</span><span class="op">==</span><span class="st">"Incidence"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour<span class="op">=</span><span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">age_range</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"time (days)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"case fraction"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></code></pre></div>
<p><img src="SEIRDNPIAge_files/figure-html/unnamed-chunk-14-1.png" width="672"> This illustrates a common trend across all age groups: the intervention decreases the peak case load and lengthens the epidemic. This is an example of what has colloquially been referred to as “flattening the [epidemic] curve”. This flattening is particularly important as it can reduce the peak burden on the health services, which could prevent it from being overwhelmed with demand.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references">
<div id="ref-davies2020effects">
<p>Davies, Nicholas G, Adam J Kucharski, Rosalind M Eggo, Amy Gimma, W John Edmunds, Thibaut Jombart, Kathleen O’Reilly, et al. 2020. “Effects of Non-Pharmaceutical Interventions on Covid-19 Cases, Deaths, and Demand for Hospital Services in the Uk: A Modelling Study.” <em>The Lancet Public Health</em> 5 (7): e375–e385.</p>
</div>
<div id="ref-ferguson2020report">
<p>Ferguson, Neil, Daniel Laydon, Gemma Nedjati Gilani, Natsuko Imai, Kylie Ainslie, Marc Baguelin, Sangeeta Bhatia, et al. 2020. “Report 9: Impact of Non-Pharmaceutical Interventions (Npis) to Reduce Covid19 Mortality and Healthcare Demand.”</p>
</div>
<div id="ref-flaxman2020estimating">
<p>Flaxman, Seth, Swapnil Mishra, Axel Gandy, H Juliette T Unwin, Thomas A Mellan, Helen Coupland, Charles Whittaker, et al. 2020. “Estimating the Effects of Non-Pharmaceutical Interventions on Covid-19 in Europe.” <em>Nature</em> 584 (7820): 257–61.</p>
</div>
<div id="ref-ifglockdowns2022">
<p>IFG. 2021. “Timeline of UK coronavirus lockdowns, March 2020 to March 2021.” <a href="https://www.instituteforgovernment.org.uk/sites/default/files/timeline-lockdown-web.pdf" class="external-link">https://www.instituteforgovernment.org.uk/sites/default/files/timeline-lockdown-web.pdf</a>.</p>
</div>
<div id="ref-lai2020effect">
<p>Lai, Shengjie, Nick W Ruktanonchai, Liangcai Zhou, Olivia Prosper, Wei Luo, Jessica R Floyd, Amy Wesolowski, et al. 2020. “Effect of Non-Pharmaceutical Interventions to Contain Covid-19 in China.” <em>Nature</em> 585 (7825): 410–13.</p>
</div>
<div id="ref-li2021temporal">
<p>Li, You, Harry Campbell, Durga Kulkarni, Alice Harpur, Madhurima Nundy, Xin Wang, Harish Nair, Usher Network for COVID, and others. 2021. “The Temporal Association of Introducing and Lifting Non-Pharmaceutical Interventions with the Time-Varying Reproduction Number (R) of Sars-Cov-2: A Modelling Study Across 131 Countries.” <em>The Lancet Infectious Diseases</em> 21 (2): 193–202.</p>
</div>
<div id="ref-stayathome2021">
<p>UK government. 2021. “Stay at home: guidance for households with possible or confirmed coronavirus (COVID-19) infection. Updated 2 December 2021.” <a href="https://www.gov.uk/government/publications/covid-19-stay-at-home-guidance/stay-at-home-guidance-for-households-with-possible-coronavirus-covid-19-infection" class="external-link">https://www.gov.uk/government/publications/covid-19-stay-at-home-guidance/stay-at-home-guidance-for-households-with-possible-coronavirus-covid-19-infection</a>.</p>
</div>
<div id="ref-verity2020estimates">
<p>Verity, Robert, Lucy C Okell, Ilaria Dorigatti, Peter Winskill, Charles Whittaker, Natsuko Imai, Gina Cuomo-Dannenburg, et al. 2020. “Estimates of the Severity of Coronavirus Disease 2019: A Model-Based Analysis.” <em>The Lancet Infectious Diseases</em> 20 (6): 669–77.</p>
</div>
<div id="ref-xin2021estimating">
<p>Xin, Hualei, Yu Li, Peng Wu, Zhili Li, Eric HY Lau, Ying Qin, Liping Wang, Benjamin J Cowling, Tim Tsang, and Zhongjie Li. 2021. “Estimating the Latent Period of Coronavirus Disease 2019 (Covid-19).” <em>Clinical Infectious Diseases: An Official Publication of the Infectious Diseases Society of America</em>.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by The Como-DTC Development Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
